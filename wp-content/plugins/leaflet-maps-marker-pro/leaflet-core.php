<?php // Before trying to crack the plugin, please consider buying a pro license at https://www.mapsmarker.com. I have put hundreds of hours into the development of the plugin and without honest customers I will not be able to continue the development and support. Thanks for your understanding and your honesty! Robert
if (basename($_SERVER["SCRIPT_\106ILENAME"]) == "leaflet-c\157\162\145.php") { exit ("Please d\157\040not access thi\163\040file directly\056\040Thanks!<br/><\141\040\150ref='htt\160\163\072//www.m\141\160\163marker.\143\157m/go'>www.\155\141\160smarker\056\143om</a>"); } if (is_admin()) { include_once (ABSPATH."wp-admi\156".DIRECTORY_SEPARATOR."inc\154\165\144es".DIRECTORY_SEPARATOR."plu\147\151\156.php"); if (is_plugin_active("\154\145aflet-maps-marke\162\057\154eaflet-maps\055\155\141rker.php")) { if (!is_multisite()) { deactivate_plugins("leaflet-maps-m\141\162ker/leaflet-map\163\055\155arker.php",$silent=FALSE,$network_wide=NULL); activate_plugin("\154\145\141flet-maps-m\141\162\153er-pro/lea\146\154\145t-maps-m\141\162\153er.php",$redirect="\160lugins.php?activate=\164\162\165e",$network_wide=FALSE,$silent=FALSE); } else { include_once (ABSPATH."\167p-includes".DIRECTORY_SEPARATOR."\160luggable.php"); if (is_network_admin()) { deactivate_plugins("\154\145aflet-maps-ma\162\153\145r/leaflet-m\141\160\163-marker.p\150\160",$silent=FALSE,$network_wide=TRUE); activate_plugin("\154\145\141flet-maps-m\141\162\153er-pro/le\141\146\154et-maps-m\141\162\153er.php",$redirect=FALSE,$network_wide=TRUE,$silent=FALSE); } else { deactivate_plugins("\154eaflet-maps\055\155\141rker/leafl\145\164\055maps-marke\162\056\160hp",$silent=FALSE,$network_wide=NULL); activate_plugin("leafl\145\164\055maps-marker-\160\162\157/leaflet-m\141\160\163-marker.ph\160",$redirect="plugins.php?act\151\166\141te=true",$network_wide=FALSE,$silent=FALSE); } } } } define( "l0" ,"\170\060029917341q"); define( "LEAFLET_WP_ADMIN_URL" ,get_admin_url()); define( "LEAFLET_PLUGIN_URL" ,plugin_dir_url( __FILE__)); define( "LEAFLET_PLUGIN_DIR" ,plugin_dir_path( __FILE__)); $O0=wp_upload_dir(); define( "LEAFLET_PLUGIN_ICONS_URL" ,$O0["\142aseurl"]."/leaflet-maps-m\141\162\153er-icons"); define( "LEAFLET_PLUGIN_ICONS_DIR" ,$O0["\142\141sedir"].DIRECTORY_SEPARATOR."\154\145\141flet-maps-ma\162\153\145r-icons"); define( "LEAFLET_PLUGIN_QR_URL" ,$O0["\142\141\163eurl"]."/leaflet-m\141\160\163-marker-qr-\143\157\144es"); define( "LEAFLET_PLUGIN_QR_DIR" ,$O0["\142\141\163edir"].DIRECTORY_SEPARATOR."\154\145\141flet-maps-mar\153\145\162-qr-codes"); define( "l1" ,get_admin_url()); define( "O1" ,plugin_dir_url( __FILE__)); define( "l2" ,plugin_dir_path( __FILE__)); define( "O2" ,$O0["baseurl"]."/leafle\164\055\155aps-marker-\151\143\157ns"); define( "l3" ,$O0["basedir"].DIRECTORY_SEPARATOR."leafl\145\164\055maps-marke\162\055\151cons"); if (is_admin()) { require_once (plugin_dir_path( __FILE__)."\151\156c".DIRECTORY_SEPARATOR."clas\163\055\160lugin-updat\145\055\143hecker.php"); } function O3() { if ((substr($_SERVER["REMOTE_ADDR"],0,4) == "127\056") || ($_SERVER["REMOTE_AD\104\122"] == "\072\0721")) { return TRUE; } else { return FALSE; } } class l4 { function __construct() { $O4=get_option("\154\145afletmapsmark\145\162\137options"); add_action("init",array( &$this,"lmm_load_tra\156\163\154ation_file\163"),1); add_action("admin_init",array( &$this,"\154mm_load_settin\147\163\137class"),2); add_action("\141\144min_init",array( &$this,"lmm_install\137\141\156d_updates"),3); add_action("wp_enque\165\145\137scripts",array( &$this,"\154\155m_frontend_enque\165\145\137scripts")); add_action("wp_print_styles",array( &$this,"lmm_fr\157\156\164end_enqueue_st\171\154\145sheets"),4); add_action("\141dmin_menu",array( &$this,"lmm_admi\156\137\155enu"),5); add_action("admin_init",array( &$this,"\154mm_plugin_meta\137\154\151nks"),6); add_action("wp_\141\152\141x_mapsmarker_a\152\141\170_actions",array( &$this,"lmm_ajax_actions"),7); add_action("\141\144\155in_bar_menu",array( &$this,"\154\155\155_add_admin_bar\137\155\145nu"),0225); if (!empty($O4)) { add_shortcode($O4["shortc\157\144\145"],array( &$this,"lmm_showmap")); } add_filter("\167\151dget_text","\144o_shortcode"); if ( isset ($O4["misc_global_admin\137\156\157tices"]) && ($O4["misc_global_adm\151\156\137notices"] == "sh\157\167")) { add_action("\141dmin_notices",array( &$this,"\154\155\155_compatibili\164\171\137checks")); } if (!empty($O4)) { if ($O4["misc_add_georss_t\157\137\150ead"] == "enabled") { add_action("wp_he\141\144",array( &$this,"\154mm_add_georss\137\164\157_head")); } } if ( isset ($O4["\155\151sc_tinymce_butt\157\156"]) && ($O4["\155\151\163c_tinymce_bu\164\164\157n"] == "enabled")) { require_once (plugin_dir_path( __FILE__)."\151nc".DIRECTORY_SEPARATOR."\164\151nymce-plugin.ph\160"); } if ( isset ($O4["\155isc_plugin_langua\147\145"]) && ($O4["\155isc_plugin_langua\147\145"] != "\141utomatic")) { add_filter("\160\154ugin_locale",array( &$this,"\154\155\155_set_plugin_lo\143\141\154e"),"\154\155\155"); } add_action("widgets_ini\164",create_function("","return regis\164\145\162_widget(\042\103\154ass_leaflet_\162\145\143ent_marke\162\137\167idget\042\051\073")); if ( isset ($O4["misc_admin_das\150\142\157ard_widget"]) && ($O4["\155isc_admin_dashb\157\141\162d_widget"] == "enab\154\145\144")) { if (!is_multisite()) { add_action("\167\160_dashboard_\163\145\164up",array( &$this,"\154\155m_register_widg\145\164\163")); } else { add_action("wp_network\137\144\141shboard_setu\160",array( &$this,"\154\155\155_register_wid\147\145\164s")); add_action("wp_dash\142\157\141rd_setup",array( &$this,"lmm_r\145\147\151ster_widgets")); } } if (( isset ($O4["\155\151\163c_pointers"])) && ($O4["\155isc_pointers"] == "enabled")) { $version_before_update=get_option("lea\146\154\145tmapsmarker_\166\145\162sion_pro_b\145\146\157re_update"); if ($version_before_update != "\060") { add_action("admin_\145\156\161ueue_scripts",array($this,"lmm_update_poi\156\164\145r_admin_scr\151\160\164s"),01751); } } add_action("admin_\145\156\161ueue_scripts",array($this,"lmm_feature_poin\164\145\162_admin_scri\160\164\163"),01752); if (is_multisite()) { add_action("\144elete_blog",array( &$this,"\154\155m_delete_multi\163\151\164e_blog")); } add_action("template_include",array( &$this,"\154\155\155_template_\143\150\145ck_shortcode")); add_action("\160lugin_row_me\164\141",array( &$this,"lmm_plugins_pag\145\137\141dd_links"),012,2); add_filter("\165pload_mimes",array( &$this,"l\155\155\137permit_mime_ty\160\145\163_on_upload")); add_filter("post_mime_typ\145\163",array( &$this,"\154mm_modify_post_m\151\155\145_types")); } function lmm_ajax_actions() { include ("\151\156c".DIRECTORY_SEPARATOR."\141\152ax-actions.php"); } function lmm_register_activation_hook() { global $wp_version; if (version_compare($wp_version,"\063.3","<")) { exit ("\133Maps Marker \120\162\157 - installa\164\151\157n failed!]\072\040WordPress V\145\162\163ion 3.3 \157\162\040higher \151\163 needed fo\162\040this plugi\156\040(you are u\163\151ng version ".$wp_version.") - pl\145\141\163e upgrade yo\165\162\040WordPress\040\151\156stallati\157\156\041"); } if (version_compare(phpversion(),"\065.2","<")) { exit ("[Maps Ma\162\153\145r Pro - ins\164\141\154lation fail\145\144\135: PHP 5.2 \151\163\040needed\040\146\157r this \160\154\165gin (y\157\165\040are us\151\156\147 PHP ".phpversion()."\073\040note: support\040\146\157r PHP 4 has\040\142\145en offici\141\154\154y disconti\156\165\145d since \062\06007-12-31!) \055\040please upg\162\141de your PHP\040\151nstallatio\156\041"); } } function lmm_modify_post_mime_types($post_mime_types) { $post_mime_types["text/gpx"]=array(__("GPX track","lmm"),__("Man\141\147\145 GPX tracks","\154mm"),_n_noop("GPX track <s\160\141\156 class=\042\143\157unt\042>(%\163\051\074/span>","\107\120X tracks <span \143\154\141ss=\042co\165\156\164\042>(%\163\051\074/span>","\154\155m")); return $post_mime_types; } function lmm_permit_mime_types_on_upload($existing_mimes=array()) { $existing_mimes["gpx"]="\164\145\170t/gpx"; return $existing_mimes; } function lmm_plugins_page_add_links($links,$file) { $plugin="\154eaflet-maps-mark\145\162\055pro/leafl\145\164\055maps-mark\145\162\056php"; $l5=get_option("\154eafletmapsma\162\153\145r_version_p\162\157"); if ($file == $plugin) { $O5="\074a style=\042\164\145xt-decoration\072\156\157ne;\042\040\164\151tle=\042".esc_attr__("\115\141psMarker aff\151\154\151ate program \055\040sign up now \141\156\144 receive \143\157\155missions\040\165\160 to 50\045\041","lmm")."\042 href=\042\150\164tps://www.m\141\160\163marker.com/\141\146\146iliates\042\040\164arget=\042\137\142lank\042\076\074img src=\042".O1."\151nc/img/icon-aff\151\154\151ates.png\042\040\167\151dth=\042\061\066\042 heig\150\164\075\04216\042\040alt=\042".esc_attr__("\115\141psMarker affili\141\164\145 program -\040\163\151gn up now\040\141\156d recei\166\145\040commissi\157\156\163 up to \065\060%!","lmm")."\042></a>"; $l6="\074a style=\042\164\145xt-decoration:\156\157\156e;\042 ti\164\154\145=\042".esc_attr__("MapsMarke\162\040\162eseller pr\157\147\162am - re-sel\154\040with a 20% d\151\163\143ount!","\154\155m")."\042 href=\042\150\164tps://www.ma\160\163\155arker.com/r\145\163\145ller\042\040\164\141rget=\042\137\142lank\042>\074\151mg src=\042".O1."\151\156\143/img/icon-r\145\163\145llers.png\042\040\167idth=\042\061\066\042 heigh\164\075\04216\042\040\141\154t=\042".esc_attr__("\115\141\160sMarker res\145\154\154er program \055\040re-sell with \141\040\0620% disc\157\165\156t!","\154\155m")."\042></a>"; $O6="<a style=\042\164\145xt-decoration:\156\157\156e;\042 h\162\145\146=\042ht\164\160\163://www.ma\160\163\155arker.c\157\155\057review\163\042 target=\042\137\142lank\042\040\164itle=\042".esc_attr__("\160lease rate this\040\160\154ugin on wor\144\160\162ess.o\162\147","\154mm")."\042><img src=\042".O1."\151nc/img/icon-star.\160\156\147\042 widt\150\075\04216\042\040\150\145ight=\042\061\066\042 alt=\042".esc_attr__("\160\154\145ase rate thi\163\040\160lugin on wo\162\144\160ress.org","lmm")."\042><\057\141\076"; $l7="<a href=\042h\164\164\160s://translat\145\056\155apsmarker.\143\157\155/projects\057\154\155m\042 \164\141\162get=\042\137\142lank\042\040\164itle=\042".esc_attr__("tr\141\156\163lations","\154\155m")."\042><img src=\042".O1."\151\156c/img/icon-tra\156\163\154ations.png\042\040\167idth=\042\061\066\042 heigh\164\075\04216\042\040\141\154t=\042".esc_attr__("\164\162anslations","\154\155m")."\042></a>"; $O7="<a href\075\042\150ttps://fac\145\142\157ok.com/map\163\155\141rker\042\040\164\141rget=\042\137\142lank\042\040\164\151tle=\042".esc_attr__("Follow MapsMarke\162\040on Facebook","lmm")."\042><img src=\042".O1."\151nc/img/icon-faceb\157\157\153.png\042 w\151\144\164h=\04216\042\040\150eight=\042\061\066\042 alt\075\042".esc_attr__("\106\157llow MapsMarke\162\040\157n Facebook","\154mm")."\042></a>"; $l8="<a href=\042h\164\164\160s://twitter.\143\157\155/mapsmarke\162\042\040target=\042\137\142lank\042\040\164itle=\042".esc_attr__("\106\157llow @MapsMarke\162\040\157n Twitter","lmm")."\042><img src=\042".O1."\151\156c/img/icon-twitte\162\056\160ng\042 \167\151\144th=\042\061\066\042 height\075\04216\042\040\141lt=\042".esc_attr__("Follow @\115\141\160sMarker on Twi\164\164\145r","\154mm")."\042></a>"; $O8="\074a href=\042\150\164\164ps://www.m\141\160\163marker.com/\053\042 target=\042\137\142\154ank\042\040\164itle=\042".esc_attr__("\106ollow MapsMarker \157\156\040Google+","\154mm")."\042><img src=\042".O1."\151nc/img/icon-googl\145\055\160lus.png\042\040\167idth=\0421\066\042 height=\042\061\066\042 alt=\042".esc_attr__("\106ollow MapsMark\145\162\040on Google+","lmm")."\042></a>"; $l9="<a hre\146\075\042https://fee\144\163\056feedburne\162\056\143om/MapsMa\162\153\145r\042 ta\162\147\145t=\042_\142\154\141nk\042\040\164itle=\042\122\123S\042><img\040\163rc=\042".O1."\151nc/img/icon-rss.pn\147\042\040width=\042\061\066\042 heig\150\164\075\04216\042\040\141lt=\042\162\163\163\042><\057\141>"; $O9="<a href\075\042\150ttp://feedb\165\162\156er.google.c\157\155\057fb/a/mail\166\145\162ify?uri=M\141\160\163Marker\042\040\164arget=\042\137\142lank\042\040\164itle=\042\122\123S (via Em\141\151\154)\042>\074\151mg src=\042".O1."\151\156c/img/icon-rss-\145\155\141il.png\042\040\167\151dth=\042\061\066\042 heig\150\164\075\04216\042\040\141lt=\042\162\163s-email\042\076\074/a>"; if ((la($Oa=FALSE,$lb=TRUE) === TRUE) && (la() === FALSE)) { $Ob="\074br\057\076\074/td></tr><\164\162\076<td colspa\156\075\0423\042\040\163\164yle=\042\142\157rder-bottom:\061\160x solid #cc\143\073padding:0\073\042><div style\075\042padding: 3\160\170\0405px;ba\143\153ground-col\157\162\072 #FFEB\105\070\073borde\162\072 1px solid\040\043CC0000;co\154\157r: #333;\042\076\074strong\076".__("\127\141rning: your\040\141\143cess to up\144\141\164es and su\160\160\157rt for Ma\160\163\040Marker P\162\157\040has exp\151\162ed!","lmm")."\074/strong><br\057\076"; $lc=get_option("lea\146\154\145tmapsmarker_v\145\162\163ion_pro_lat\145\163\164"); if (($lc != NULL) && ($lc>$l5)) { $Ob.=__("\114atest availa\142\154\145 version:","lmm")." <a hre\146\075\047https://w\167\167\056mapsmarke\162\056\143om/v".$lc."p' target\075\047\137blank' titl\145\075\047".esc_attr__("click to \163\150\157w release not\145\163","\154\155\155")."'>".$lc."\074\057a> "."(<a h\162\145\146='www.mapsmar\153\145\162.com/changel\157\147\057pro/' tar\147\145\164='_blank'>".__("show all availab\154\145\040changelogs","lmm")."</a>)<br/>"; } $Ob.=sprintf(__("Yo\165\040\143an continue \165\163\151ng version \045\163\040without\040\141\156y limita\164\151\157ns. Neve\162\164\150eless y\157\165\040will n\157\164\040be abl\145\040to get upd\141\164\145s inclu\144\151\156g bugfi\170\145\163, new \146\145\141tures \141\156\144 optim\151\172\141tions \141\163\040well a\163\040access to\040\157ur suppor\164\040system. ","\154mm"),$l5)."<br/>".sprintf(__("<a h\162\145\146=\042%s\042\076\120lease renew \171\157\165r access t\157\040\165pdates a\156\144\040support \164\157\040keep y\157\165\162 plugin\040\165p-to-date a\156\144\040safe</\141\076.","\154mm"),l1."admin.php?pa\147\145\075leafletmap\163\155\141rker_licens\145")."</di\166\076"; } else { $Ob=""; } $links[]=$O5."&nbsp;".$l6."&nbsp;".$O6."&nbsp;".$l7."&nbsp;".$O7."\046nbsp;".$l8."&nbsp;".$O8."&nbsp;".$l9."\046nbsp;".$O9.$Ob; } return $links; } function lmm_delete_multisite_blog($blog_id) { switch_to_blog($blog_id); $GLOBALS["wpdb"]->query("DROP TABLE `".$GLOBALS["wpdb"]->prefix."\154eafletmapsmar\153\145\162_layers`"); $GLOBALS["wpdb"]->query("\104\122\117P TABLE `".$GLOBALS["\167pdb"]->prefix."l\145\141\146letmapsmarker_\155\141rkers`"); $O0=wp_upload_dir(); $icons_directory=$O0["\142asedir"].DIRECTORY_SEPARATOR."\154eaflet-maps-mark\145\162\055icons".DIRECTORY_SEPARATOR; if (is_dir($icons_directory)) { foreach (glob($icons_directory."\052\056*") as $v) { unlink($v); } rmdir($icons_directory); } } function lmm_update_pointer_admin_scripts() { $dismissed_pointers=explode("\054",( string) get_user_meta(get_current_user_id(),"di\163\155\151ssed_wp_point\145\162\163",TRUE)); $dismissed_pointers=array_flip($dismissed_pointers); $Oc=FALSE; $lmm_version_new=get_option("leafletmapsmark\145\162\137version_pro"); $ld="lmmvp".str_replace(".","",$lmm_version_new); if (! isset ($dismissed_pointers[$ld])) { $current_dismissed_wp_pointers=get_user_meta(get_current_user_id(),"\144ismissed_wp_p\157\151\156ters"); $replace_lmmv=preg_replace("\057\050lmmv(p)?(\134\144\051\053(,)?)/",NULL,$current_dismissed_wp_pointers["0"]); $replace_without_end_coma=preg_replace("\057(,)\044/",NULL,$replace_lmmv); update_user_meta(get_current_user_id(),"dis\155\151\163sed_wp_pointe\162\163",$replace_without_end_coma); $Oc=TRUE; add_action("admin_print_foot\145\162\137scripts",array($this,"\154mm_update_poin\164\145\162_footer_scrip\164")); } if ($Oc) { wp_enqueue_script("\167\160-pointer"); wp_enqueue_style("\167p-pointer"); } } function lmm_update_pointer_footer_script() { $O4=get_option("leafletmap\163\155\141rker_option\163"); $lmm_version_new=get_option("\154\145afletmapsmarker\137\166\145rsion_pro"); $ld="lmmvp".str_replace(".","",$lmm_version_new); $Od="\074h3>".sprintf(esc_attr__("Maps Mark\145\162\040Pro plugin \165\160\144ate to v%1\163\040was successf\165\154","lmm"),$lmm_version_new)."<\057\150\063>"; if (get_option("\154\145\141fletmapsmark\145\162\137update_info") == "\163\150\157w") { $changelog_url="<a h\162\145\146=\042".l1."\141dmin.php?page=lea\146\154\145tmapsmarker\137\155\141rkers"."\042 \163\164\171le=\042text\055\144\145coration:n\157\156\145;\042>".__("cha\156\147\145log","\154\155m")."\074/a>"; } else { $changelog_url="<a href=\042\150\164tps://www.map\163\155\141rker.com/v".$lmm_version_new."p\042\040\163tyle=\042\164\145\170t-decorati\157\156\072none;\042\040\164arget=\042\137\142\154ank\042\076".__("ch\141\156\147elog","lmm")."\074/a>"; } $blogpost_url="\074a href=\042\150\164\164ps://www.map\163\155\141rker.com/v".$lmm_version_new."\160\042 target\075\042\137blank\042\040\163tyle=\042te\170\164\055decoratio\156\072\156one;\042\076\155apsmarker.c\157\155\074/a>"; $Od.="\074\160>".sprintf(esc_attr__("\120lease see the\040\045\061s for new\040\146\145atures or\040\164\150e blog p\157\163\164 on %2s f\157\162\040more d\145\164\141ils","lm\155"),$changelog_url,$blogpost_url)."</p>"; ?><?php echo "\015\012\011\011<sc\162\151\160t type=\042\164\145xt/javascrip\164\042\076// <![CD\101\124\101[\015\012\011\011jQuery\050\144\157cument\051\056ready(func\164\151\157n(\044\051\040\173\015\012\011\011\011\151\146\050typeof\050\152Query().p\157\151\156ter) !\075\040'undefine\144\047) \173\015\012\011\011\011\011\044('#topl\145\166el_page_\154\145\141fletma\160\163marker_ma\162\153\145rs').\160\157inter(\173\015\012\011\011\011\011\011\143\157ntent: '"; ?><?php echo $Od; ?><?php echo "\047\054\015\012\011\011\011\011\011\160\157sition: \173\015\012\011\011\011\011\011\011ed\147\145\072 'left\047\054\015\012\011\011\011\011\011\011\141lign: 'c\145\156\164er'\015\012\011\011\011\011\011},\015\012\011\011\011\011\011\143lose: \146\165\156ction(\051\040\173\015\012\011\011\011\011\011\011\044\056\160ost( ajax\165\162l, \173\015\012\011\011\011\011\011\011\011\160\157inter\072\040'"; ?><?php echo $ld; ?><?php echo "\047\054\015\012\011\011\011\011\011\011\011action: 'dis\155\151\163s-wp-poin\164\145\162'\015\012\011\011\011\011\011\011});\015\012\011\011\011\011\011\175\015\012\011\011\011\011\175\051.pointer\050\047open');\015\012\011\011\011\175\015\012\011\011\175);\015\012\011\011// ]]>\074\057script>\015\012\011\011"; ?><?php } function lmm_feature_pointer_admin_scripts() { $dismissed_pointers=explode("\054",( string) get_user_meta(get_current_user_id(),"\144ismissed_wp_p\157\151\156ters",TRUE)); $dismissed_pointers=array_flip($dismissed_pointers); $Oc=FALSE; if (! isset ($dismissed_pointers["\154mmesw"])) { $Oc=TRUE; add_action("\141dmin_print_foot\145\162\137scripts",array($this,"\154\155m_feature_po\151\156\164er_footer_s\143\162\151pt")); } if ($Oc) { wp_enqueue_script("\167p-pointer"); wp_enqueue_style("\167\160-pointer"); } } function lmm_feature_pointer_footer_script() { include ("\151\156c".DIRECTORY_SEPARATOR."\146\145ature-pointers.\160\150\160"); } function lmm_register_widgets() { $O4=get_option("\154\145afletmapsmarker\137\157\160tions"); if ($O4["mis\143\137\167hitelabel_bac\153\145\156d"] == "enabled") { $le=__("Maps - recent ma\162\153\145rs","lmm"); } else { $le=__("\115aps Marker \120\162\157 - recent m\141\162\153ers","lmm"); } wp_add_dashboard_widget("\154\155m-admin-dashboar\144\055\167idget",$le,array( &$this,"lmm_dashboard_wid\147\145\164"),array( &$this,"\154mm_dashboard\137\167\151dget_control")); } function lmm_dashboard_widget() { global $wpdb; $O4=get_option("le\141\146\154etmapsmarker_\157\160\164ions"); if ($O4["default\163\137\155arker_custom\137\151\143on_url_dir"] == "\156\157") { $defaults_marker_icon_dir=l3; $defaults_marker_icon_url=O2; } else { $defaults_marker_icon_dir=htmlspecialchars($O4["defaults_\155\141\162ker_icon_dir"]); $defaults_marker_icon_url=htmlspecialchars($O4["defaults_mark\145\162\137icon_url"]); } $table_name_markers=$wpdb->prefix."\154eafletmapsmark\145\162\137markers"; $widgets=get_option("\144ashboard_wid\147\145\164_options"); $widget_id="\154\155m-admin-dash\142\157\141rd-widget"; $number_of_markers= isset ($widgets[$widget_id]) && isset ($widgets[$widget_id]["items"]) ? absint($widgets[$widget_id]["\151tems"]): 4; if ((la($Oa=FALSE,$lb=TRUE) === TRUE) && (la() === FALSE)) { $l5=get_option("\154eafletmapsma\162\153\145r_version_pr\157"); echo "<div style\075\042padding: 3px 5p\170\073\142ackground-c\157\154\157r: #FFEB\105\070\073border:\040\061px solid #\103\103\060000;bo\162\144\145r-radi\165\163\072 3px;c\157\154\157r: #333\073\042><strong>".__("Warnin\147\072\040your acces\163\040\164o updates a\156\144\040support f\157\162\040Maps Mar\153\145\162 Pro ha\163\040\145xpired\041","\154\155m")."</strong><br/>"; $lc=get_option("\154\145afletmapsmark\145\162\137version_pro_\154\141\164est"); if (($lc != NULL) && ($lc>$l5)) { echo __("Latest available\040\166\145rsion:","\154mm")."\040<a href='ht\164\160\163://www.mapsm\141\162\153er.com/v".$lc."p' target='_\142\154\141nk' title='".esc_attr__("click t\157\040\163how release\040\156\157tes","\154mm")."\047>".$lc."\074/a> "."(<a href=\047\167\167w.mapsmarke\162\056\143om/changel\157\147\057pro/' ta\162\147\145t='_blank\047\076".__("show a\154\154\040available ch\141\156\147elogs","\154mm")."\074/a>)<br/>"; } echo sprintf(__("You\040\143\141n continue \165\163\151ng version %\163\040without any \154\151\155itations.\040\116\145verthe\154\145\163s you w\151\154\154 not b\145\040able to ge\164\040\165pdates\040\151ncluding b\165\147\146ixes, n\145\167\040featu\162\145\163 and o\160\164\151mizati\157\156\163 as we\154\154\040as ac\143\145\163s to \157\165\162 supp\157\162\164 syst\145\155\056 ","\154mm"),$l5)."<br\057\076".sprintf(__("<\141\040\150ref=\042\045\163\042>Please re\156\145\167 your acces\163\040\164o update\163\040and support\040\164\157 keep \171\157\165r plugi\156\040up-to-date\040\141nd safe</a\076\056","\154mm"),l1."admin\056\160\150p?page=leafl\145\164\155apsmarker_\154\151\143ense")."</div>"; echo "\074\150r style=\042\142\157\162der:0;height\072\061\160x;backgr\157\165\156d-color:#d\070\1448d8;\042/>"; } $Oe=$wpdb->get_results($wpdb->prepare( "\123\105LECT `id`,`\155\141\162kername`,`ic\157\156\140,`createdon\140\054\140createdby\140\040\106ROM `$table_name_markers` OR\104\105\122 BY `createdon\140\040\144esc LIMIT \045\144" ,$number_of_markers),ARRAY_A); if ($Oe != NULL) { echo "<table styl\145\075\042margin-b\157\164\164om:5px;\042\076\074tr>"; foreach ($Oe as $row) { $icon=($row["icon"] == NULL) ? O1."leaflet-dist/\151\155\141ges/marker\056\160\156g": $defaults_marker_icon_url."/".$row["icon"]; echo "\074\164d><a href=\042".l1."\141dmin.php?pag\145\075\154eafletmap\163\155\141rker_marker\046\151\144=".$row["\151d"]."\042 title=\042".esc_attr__("edi\164\040\155arker","\154\155\155")."\042><img src=\042".$icon."\042 style=\042w\151\144\164h:80%;\042\076\074/a>"; echo "<td s\164\171\154e=\042ver\164\151\143al-align:top\073\154\151ne-heigh\164\072\061.2em;\042\076"; echo "\074\141\040href=\042".l1."admin.php?pa\147\145\075leafletmaps\155\141\162ker_marker&\151\144\075".$row["id"]."\042 \164\151\164le=\042".esc_attr__("\145\144\151t marker","\154mm")."\042\076".htmlspecialchars(stripslashes($row["markername"]))."\074\057a><br/>".__("\143\162\145ated on","\154\155m")." ".date("Y-m-d - \150\072\155",strtotime($row["create\144\157\156"]))."\054\040".__("\143reated by","lm\155")." ".$row["createdby"]; echo "</td>\074\057\164r>"; } echo "<\057\164\141ble>"; } else { echo "<p style=\042\155\141rgin-bottom\072\065\160x;\042\076".__("\116\157 marker created \171\145\164","\154\155m")."\074/p>"; } if (! isset ($widgets[$widget_id]["\142logposts"])) { $lf=1; } else if ( isset ($widgets[$widget_id]["blogposts"]) && ($widgets[$widget_id]["\142logposts"] == 1)) { $lf=0; } else { $lf=1; } function lmm_spc_custom_name($Of) { return "mapsmarker-da\163\150\142oard-widge\164\055\162ss-item-ca\143\150\145"; } if (($lf == 1) && ($O4["misc_whitelabel_b\141\143\153end"] == "disabled")) { require_once (ABSPATH.WPINC.DIRECTORY_SEPARATOR."class-simple\160\151\145.php"); $lg=new simplepie(); if (file_exists($defaults_marker_icon_dir.DIRECTORY_SEPARATOR."readme-i\143\157\156s.txt")) { $lg->enable_cache(TRUE); $lg->set_cache_location($location=$defaults_marker_icon_dir); $lg->set_cache_name_function("lmm_spc_custom_n\141\155\145"); $lg->set_cache_duration(0250600); } else { $lg->enable_cache(FALSE); } $lg->set_feed_url("\150\164tp://feeds.feed\142\165\162ner.com/Maps\115\141\162kerPro"); $lg->set_stupidly_fast(TRUE); $lg->enable_order_by_date(TRUE); $lg->init(); $lg->handle_content_type(); echo "<hr style=\042\142\157rder:0;heigh\164\072\061px;backgro\165\156\144-color:#d\070\144\070d8;\042\057\076<strong><p\076".__("\114\141test blog p\157\163\164s from www.m\141\160\163marker.com","l\155\155")."\074\057p></strong>"; if ($lg->get_items() == NULL) { $blogpost_url="<a\040\150\162ef=\042ht\164\160\163://www.mapsm\141\162\153er.com/n\145\167\163\042 tar\147\145\164=\042_\142\154\141nk\042>\150\164\164ps://w\167\167\056mapsma\162\153\145r.com/n\145\167\163</a>"; echo sprintf(__("\106eed could not\040\142\145 retrieved,\040\160\154ease try a\147\141\151n later o\162\040\162ead the \154\141\164est blog\040\160osts at %s","\154\155\155"),$blogpost_url); } foreach ($lg->get_items(0,3) as $item) { echo "<p  sty\154\145\075\042margi\156\072\060.5em 0;\042\076".$item->get_date("\152 F Y").": <strong><a hre\146\075\042".$item->get_permalink()."?ref\075\144\141shboard\042\076".$item->get_title()."\074\057a></strong><\057\160\076".PHP_EOL; } echo "<p><a styl\145\075\042text-d\145\143\157ration:non\145\073\042 href=\042\150\164tps://www\056\155\141psmarke\162\056com\042 ta\162\147et=\042_b\154\141\156k\042>\074\151mg src=\042".O1."\151\156c/img/icon-webs\151\164\145-home.png\042\040\167idth=\0421\066\042 height=\042\061\066\042 alt=\042\155\141psmarker\056\143\157m\042\076\040MapsMarker\056\143\157m</a>&\156\142\163p;<a st\171\154\145=\042\164\145\170t-decor\141\164ion:none;\042\040\164it\154\145\075\042".esc_attr__("\115\141psMarker affi\154\151\141te program \055\040\163ign up no\167\040\141nd receiv\145\040\143ommissio\156\163\040up to \065\060%!","\154\155\155")."\042\040\150ref=\042h\164\164\160s://www.maps\155\141\162ker.com/a\146\146\151liates\042\040\164arget=\042\137\142\154ank\042\076\074img src=\042".O1."inc/img/\151\143\157n-affiliates.\160\156\147\042 wi\144\164\150=\04216\042\040\150eight=\042\061\066\042 alt=\042".esc_attr__("MapsMa\162\153\145r affiliate \160\162\157gram - sign\040\165\160 now and \162\145\143eive com\155\151\163sions up\040\164\157 50%!","\154\155\155")."\042\076\040".__("Affiliate\163","\154mm")."</a>&nbsp;<a \163\164\171le=\042t\145\170\164-decoration:\156\157\156e;\042 t\151\164\154e=\042".esc_attr__("\115\141\160sMarker resel\154\145\162 program - r\145\055\163ell with\040\141\04020% dis\143\157\165nt!","\154mm")."\042 href=\042\150\164tps://www.m\141\160\163marker.com/\162\145\163eller\042\040\164arget=\042\137\142\154ank\042\076\074img src=\042".O1."\151nc/img/icon-resell\145\162\163.png\042 \167\151\144th=\0421\066\042 height=\042\061\066\042 alt=\042".esc_attr__("\115\141\160sMarker rese\154\154\145r program - \162\145\055sell with\040\141\04020% disc\157\165\156t!","\154mm")."\042> ".__("Re\163\145\154lers","\154\155\155")."</a>&nb\163\160\073<a style=\042\164\145xt-decoration:\156\157ne;\042\040\150ref=\042ht\164\160\163://www.m\141\160\163marker.\143\157\155/review\163\042 target=\042\137\142lank\042\040\164\151tle=\042".esc_attr__("please ra\164\145\040this plugin \157\156\040wordpress.or\147","\154\155m")."\042><img\040\163\162c=\042".O1."\151nc/img/icon-star.p\156\147\042 width=\042\061\066\042 heig\150\164\075\04216\042\040\141lt=\042".esc_attr__("please rate\040\164\150is plugin o\156\040\167ordpress.or\147","\154\155m")."\042> ".__("\162\141\164e plugin","\154\155m")."</a>&nbsp;<a href\075\042\150ttps://tra\156\163\154ate.mapsmar\153\145\162.com/pro\152\145\143ts/lmm\042\040\164arget=\042\137\142lank\042\076\074img src\075\042".O1."i\156\143\057img/icon-tra\156\163\154ations.png\042\040\167idth=\042\061\066\042 heig\150\164\075\04216\042\040alt=\042tr\141\156\163lation\163\042> ".__("translations","lmm")."</a>&nb\163\160\073<a href=\042\150\164tps://twitter\056\143\157m/mapsma\162\153\145r\042 t\141\162\147et=\042\137\142\154ank\042\076\074img src=\042".O1."\151\156c/img/icon-twit\164\145\162.png\042 wi\144\164\150=\04216\042\040\150eight=\042\061\066\042 alt=\042\164\167itter\042\076\040Twitter\074\057a>&nbsp;<a\040\150\162ef=\042\150\164tps://fac\145\142\157ok.com/\155\141\160smarke\162\042\040targe\164\075\042_blan\153\042><img src\075\042".O1."\151\156c/img/icon-f\141\143\145book.png\042\040\167idth=\042\061\066\042 height\075\04216\042 alt\075\042\146acebook\042\076 Facebook\074\057a>&nbsp;<a\040\150ref=\042h\164\164\160s://ww\167\056\155apsmar\153\145\162.com/+\042\040\164arget=\042\137blank\042\076\074img src=\042".O1."\151\156c/img/icon-googl\145\055\160lus.png\042\040\167idth=\0421\066\042\040height=\042\061\066\042 a\154\164\075\042go\157\147\154e+\042\076\040Google+</a\076\046nbsp;<a st\171\154\145=\042\164\145\170t-deco\162\141\164ion:no\156\145\073\042 \150\162\145f=\042\150\164tps://www\056\155apsmarker\056\143om/change\154\157\147/pro\042\040\164arget=\042\137blank\042\076\074img src=\042".O1."\151nc/img/icon-cha\156\147\145log-header.p\156\147\042 width=\042\061\066\042 heig\150\164\075\04216\042\040\141lt=\042\143\150angelog\042\076\040".__("Changelog","\154\155m")."\074/a>&nbsp;<a\040\150\162ef=\042h\164\164\160s://feeds.f\145\145\144burner.co\155\057\115apsMarke\162\042\040target=\042\137\142lank\042\076\074img src\075\042".O1."inc/img/ic\157\156\055rss.png\042\040\167idth=\0421\066\042\040height=\042\061\066\042 \141\154\164=\042rs\163\042\076 RSS</\141\076&nbsp;<a h\162\145\146=\042h\164\164\160://fee\144\142\165rner.go\157\147\154e.com/\146\142\057a/mail\166\145\162ify?ur\151\075MapsMarker\042\040target=\042\137\142lank\042\076\074img src\075\042".O1."i\156\143\057img/icon-rss\055\145\155ail.png\042\040\167idth=\0421\066\042\040height=\042\061\066\042 a\154\164\075\042rs\163\055\145mail\042\076\040".__("E-\115\141\151l","lmm")."</a></p>"; } } function lmm_dashboard_widget_control() { $O4=get_option("\154eafletmapsmarker\137\157\160tions"); $widget_id="\154\155m-admin-dashbo\141\162\144-widget"; $form_id="lmm-admi\156\055\144ashboard-wi\144\147\145t-control"; $update=FALSE; if (!$widget_options=get_option("\144ashboard_wid\147\145\164_options")) $widget_options=array(); if (! isset ($widget_options[$widget_id])) { $widget_options[$widget_id]=array("\142\154ogposts" => 0,"\151tems" => 5); $update=TRUE; } if ("\120OST" == $_SERVER["\122EQUEST_METH\117\104"] && isset ($_POST[$form_id])) { $number=($_POST[$form_id]["items"] == NULL) ? "3": absint($_POST[$form_id]["items"]); $Og= isset ($_POST[$form_id]["\142logposts"]) ? "\061": "0"; $widget_options[$widget_id]["\151\164ems"]=$number; $widget_options[$widget_id]["\142\154ogposts"]=$Og; $update=TRUE; } if ($update) update_option("dashboard_wi\144\147\145t_options",$widget_options); $number= isset ($widget_options[$widget_id]["\151tems"]) ? ( integer) $widget_options[$widget_id]["\151\164ems"]: ""; echo "\074\160\076<label for\075\042\154mm-admin-da\163\150\142oard-widg\145\164\055number\042\076".__("Number of markers\040\164\157 show:")."\040\074/label>"; echo "<input id=\042\154\155\155-admin-da\163\150\142oard-widget\055\156\165mber\042\040\156ame=\042".$form_id."\133items]\042\040\164\171pe=\042t\145\170\164\042 value\075\042".$number."\042\040size=\042\062\042\040/></p>"; if ($O4["misc_whitelabel_b\141\143\153end"] == "\144isabled") { echo "\074p><label for=\042\154\155m-admin-dash\142\157\141rd-widget-\142\154\157gposts\042\076".__("\110ide blog post\163\040\141nd link sect\151\157\156:")."\040\074/label>"; echo "<input id=\042\154\155\155-admin-da\163\150\142oard-widget\055\142\154ogposts\042\040\156ame=\042".$form_id."[blogposts]\042\040\164ype=\042chec\153\142\157x\042 ".checked($widget_options[$widget_id]["\142\154ogposts"],1,FALSE)."/></p>"; } } function lmm_load_translation_files() { load_plugin_textdomain("lmm",FALSE,dirname(plugin_basename( __FILE__))."\057languages/"); } function lmm_set_plugin_locale($lang) { $O4=get_option("le\141\146\154etmapsmarker\137\157\160tions"); global $locale; if ($O4["misc_p\154\165\147in_language_\141\162\145a"] == "backend") { return is_admin() ? $O4["\155isc_plugin_lan\147\165\141ge"]: $locale; } else if ($O4["\155isc_plugin_langu\141\147\145_area"] == "fronten\144") { return is_admin() ? $locale: $O4["\155isc_plugin_l\141\156\147uage"]; } else if ($O4["\155\151\163c_plugin_l\141\156\147uage_area"] == "bot\150") { return $O4["\155\151sc_plugin_la\156\147\165age"]; } else { return $locale; } } function lmm_compatibility_checks() { include ("inc".DIRECTORY_SEPARATOR."\143ompatibility-chec\153\163\056php"); } function lmm_help() { include ("\154eaflet-help-c\162\145\144its.php"); } function lmm_settings() { global $lh; $lh->display_page(); } function lmm_list_layers() { include ("leaflet-list-layer\163\056php"); } function lmm_list_markers() { include ("\154\145\141flet-list-m\141\162\153ers.php"); } function lmm_layer() { include ("\154\145aflet-layer.php"); } function lmm_marker() { include ("\154\145aflet-marke\162\056\160hp"); } function lmm_import_export() { include ("l\145\141\146let-import-exp\157\162\164.php"); } function lmm_tools() { include ("leaflet-tool\163\056\160hp"); } function lmm_add_georss_to_head() { $georss_to_head="\074link rel=\042\141\154ternate\042\040\164ype=\042app\154\151\143ation/rss\053\170\155l\042 t\151\164\154e=\042".get_bloginfo("\156\141me")." GeoRSS-Feed\042\040href=\042".O1."\154\145aflet-georss\056\160\150p?layer=all\042\040\057>".PHP_EOL; echo $georss_to_head; } function lmm_showmap($atts) { require ("i\156\143".DIRECTORY_SEPARATOR."showmap_\160\162\145pare.php"); return $Oh; } function lmm_load_settings_class() { if (is_admin()) { require_once (plugin_dir_path( __FILE__)."\151\156c".DIRECTORY_SEPARATOR."\143\154\141ss-leaflet-op\164\151\157ns.php"); global $lh; $lh=new class_leaflet_options(); } } function lmm_admin_menu() { global $wp_version; if (version_compare($wp_version,"\063.8-alpha","\076")) { $Oi="-white"; } else { $Oi=""; } $O4=get_option("\154\145afletmapsmarker\137\157\160tions"); if (!empty($O4)) { $capabilities=$O4["capabilities_\145\144\151t"]; } else { $capabilities="edit_posts"; $lj="activate_plugins"; } if (!empty($O4)) { if ($O4["\155\151sc_whitelabel_\142\141\143kend"] == "en\141\142\154ed") { $Oj=esc_attr__("\115aps","\154\155\155"); $lj="activate_pl\165\147\151ns"; } else { $Oj="\074spa\156\040style=\042fo\156\164\055size:92%;\042\076\115aps Mark\145\162\040Pro</spa\156\076"; $lj=$O4["\143\141pabilities_edi\164"]; } } else { $Oj=esc_attr__("\115aps","lmm"); $lj="\141ctivate_plugins"; } $page=add_object_page($Oj,$Oj,$capabilities,"\154\145afletmapsmarker_m\141\162\153ers",array( &$this,"lmm_list_m\141\162\153ers"),O1."inc/img/\151\143\157n-menu-page".$Oi."\056png"); if (!empty($O4)) { $page2=add_submenu_page("\154\145afletmapsma\162\153\145r_markers",$Oj."\040\055\040".__("\114\151\163t all marke\162\163","lmm"),"\074img src=\042".O1."\151\156c/img/icon-menu-\154\151\163t".$Oi.".pn\147\042\076 ".__("\114\151\163t all markers","\154mm"),$O4["\143\141\160abili\164\151\145s_edit"],"\154\145afletmapsmarker_ma\162\153\145rs",array( &$this,"lmm_li\163\164\137markers")); $page3=add_submenu_page("\154\145afletmapsmarker_m\141\162\153ers",$Oj." - ".__("\141\144\144/edit marker","\154mm"),"\074img src=\042".O1."\151\156c/img/icon-m\145\156\165-add".$Oi."\056\160\156g\042> ".__("Add ne\167\040\155arker","\154\155m"),$O4["capabili\164\151\145s_edit"],"\154\145\141fletmapsmarke\162\137\155arker",array( &$this,"\154mm_marker")); $page3b=add_submenu_page("\154eafletmapsma\162\153\145r_markers",$Oj." - ".__("\111\155\160ort/Export","\154mm"),"\074img src=\042".O1."\151\156c/img/icon-menu-\151\155\160ort-export".$Oi.".png\042>\040".__("\111mport/Export","\154mm"),$O4["capabilities_e\144\151\164"],"lea\146\154\145tmapsmarker_i\155\160\157rt_ex\160\157\162t",array( &$this,"lmm_import_e\170\160\157rt")); $page4=add_submenu_page("leaf\154\145\164mapsmarker_ma\162\153\145rs",$Oj." - ".__("\114\151\163t all layers","\154mm"),"\074\151mg src=\042".O1."\151\156c/img/icon-menu\055\154\151st".$Oi.".\160\156\147\042> ".__("\114ist all layers","\154mm"),$O4["capa\142\151\154ities_edit"],"\154eafletmapsmarker_\154\141\171ers",array( &$this,"\154\155m_list_layers")); $page5=add_submenu_page("l\145\141\146letmapsmarker_\155\141\162kers",$Oj." - ".__("ad\144\057\145dit layer","\154mm"),"<i\155\147\040src=\042".O1."\151\156c/img/icon-men\165\055\141dd".$Oi."\056\160\156g\042> ".__("\101\144d new layer","\154mm"),$O4["capabilitie\163\137\145dit"],"\154\145\141fletmapsmarker\137\154\141yer",array( &$this,"\154mm_layer")); } else { $page=""; $page2=""; $page3=""; $page3b=""; $page4=""; $page5=""; } $page6=add_submenu_page("leafletmapsmarke\162\137\155arkers",$Oj." - ".__("Tools","lm\155"),"<hr nosha\144\145\040size=\042\061\042/><img src=\042".O1."\151\156\143/img/icon-menu\055\164ools".$Oi."\056\160ng\042> ".__("\124\157ols","lmm"),$lj,"\154\145afletmapsmar\153\145\162_tools",array( &$this,"\154\155m_tools")); $page7=add_submenu_page("\154eafletmapsmarke\162\137\155arkers",$Oj." - ".__("Settings","lmm"),"\074img\040\163\162c=\042".O1."\151\156\143/img/icon-m\145\156\165-settings".$Oi."\056\160ng\042> ".__("\123\145\164tings","\154\155\155"),$lj,"\154\145afletmapsma\162\153\145r_settings",array( &$this,"\154\155\155_settings")); $page11=add_submenu_page("\154\145afletmapsmar\153\145\162_markers",$Oj."\040- Maps Marker AP\111","<img src=\042".O1."\151nc/img/icon-menu-\141\160\151".$Oi.".png\042\076\040Maps Marker AP\111",$lj,"\141\144min.php?page\075\154\145afletmapsm\141\162\153er_setting\163\043\154mm-misc-\163\145\143tion9"); if (!empty($O4)) { $page8=add_submenu_page("leaflet\155\141\160smarker_marke\162\163",$Oj." - ".__("\123upport","lm\155"),"\074img src=\042".O1."\151\156c/img/icon-men\165\055\150elp".$Oi."\056\160\156g\042> ".__("\123upport","lmm"),$lj,"\154eafletmapsmarker_\150\145\154p",array( &$this,"\154\155m_help")); $page10=add_submenu_page("leafletmapsmar\153\145\162_markers",$Oj." - ".__("License se\164\164ings","lmm"),"<hr nosh\141\144\145 size=\042\061\042/><img \163\162\143=\042".O1."inc/img/ic\157\156\055menu-set\164\151\156gs".$Oi."\056png\042> ".__("\114icense settings","\154mm"),$lj,"leafletmapsm\141\162\153er_license","maps\137\155\141rker_pro_lice\156\163\145_activation\137\160\141ge"); } else { $page8=""; $page10=""; } add_action("adm\151\156\137print_script\163\055".$page3,array( &$this,"lmm_admin_enqueu\145\137\163cripts"),7); add_action("\141\144min_print_sc\162\151\160ts-".$page5,array( &$this,"\154\155\155_admin_enqueue\137\163\143ripts"),8); add_action("a\144\155\151n_print_scrip\164\163\055".$page2,array( &$this,"\154mm_admin_selectj\163"),011); add_action("adm\151\156\137print_styles-".$page3,array( &$this,"\154\155m_admin_select\152\163"),011); add_action("\141\144\155in_print_sc\162\151\160ts-".$page7,array( &$this,"\154\155m_admin_sele\143\164\152s"),011); add_action("\141dmin_print_sc\162\151\160ts-".$page3,array( &$this,"\154\155m_admin_ajax_act\151\157\156sjs"),012); add_action("\141\144min_print_st\171\154\145s-".$page3,array( &$this,"lmm_admin_en\161\165\145ue_styleshee\164\163\137leaflet"),023); add_action("a\144\155\151n_print_styl\145\163\055".$page5,array( &$this,"\154mm_admin_enqueue_\163\164\171lesheets_lea\146\154\145t"),023); add_action("admin_prin\164\137\163tyles-".$page,array( &$this,"\154\155\155_admin_enqueu\145\137\163tylesheet\163"),021); add_action("\141dmin_print_styl\145\163\055".$page2,array( &$this,"\154\155\155_admin_enqu\145\165\145_stylesheet\163"),022); add_action("\141\144\155in_print_styl\145\163\055".$page3,array( &$this,"lmm_adm\151\156\137enqueue_styl\145\163\150eets"),023); add_action("admin_p\162\151\156t_styles-".$page3b,array( &$this,"\154\155m_admin_enqueue\137\163\164ylesheets"),023); add_action("admin_print_sty\154\145\163-".$page4,array( &$this,"lmm_admin_en\161\165\145ue_styleshee\164\163"),024); add_action("admin_print\137\163\164yles-".$page5,array( &$this,"lmm_admin_enque\165\145\137stylesheets"),025); add_action("\141dmin_print_\163\164\171les-".$page6,array( &$this,"lmm_admin\137\145\156queue_styles\150\145\145ts"),026); add_action("\141\144\155in_print_s\164\171\154es-".$page7,array( &$this,"lmm_admi\156\137\145nqueue_style\163\150\145ets"),027); add_action("\141\144min_print_styles\055".$page8,array( &$this,"\154\155m_admin_enqu\145\165\145_stylesheets"),027); add_action("\141\144min_print_\163\164\171les-".$page10,array( &$this,"lmm_admi\156\137\145nqueue_styles\150\145\145ts"),027); add_action("\141dmin_print_styl\145\163\055".$page3,array( &$this,"lmm_admin_\145\156\161ueue_stylesh\145\145\164s_datepicker"),030); add_action("\141\144\155in_enqueue_\163\143\162ipts",array( &$this,"\154\155m_admin_enqueue_\163\164\171lesheets_adm\151\156\142ar"),031); add_action("admin_print_sc\162\151\160ts-".$page,array( &$this,"lmm_ad\144\137\143ontextual_he\154\160")); add_action("\141dmin_print_scr\151\160\164s-".$page2,array( &$this,"\154mm_add_contextua\154\137\150elp")); add_action("\141dmin_print_scri\160\164\163-".$page3,array( &$this,"\154mm_add_conte\170\164\165al_help")); add_action("admin\137\160\162int_scripts-".$page3b,array( &$this,"\154\155\155_add_contextu\141\154\137help")); add_action("\141dmin_print_scrip\164\163\055".$page4,array( &$this,"lmm_add_contextual\137\150\145lp")); add_action("a\144\155\151n_print_script\163\055".$page5,array( &$this,"\154\155m_add_contex\164\165\141l_help")); add_action("\141\144min_print_scri\160\164\163-".$page6,array( &$this,"lmm_add_contex\164\165\141l_help")); add_action("a\144\155\151n_print_script\163\055".$page7,array( &$this,"\154\155\155_add_conte\170\164\165al_help")); add_action("\141dmin_print_scripts\055".$page8,array( &$this,"lmm_add_\143\157\156textual_help")); add_action("admin_print_script\163\055".$page10,array( &$this,"lmm_add_contextu\141\154\137help")); add_action("\141\144\155in_print_sc\162\151\160ts-".$page3,array( &$this,"lmm\137\141\144min_enqueue_sc\162\151\160ts_jqueryd\141\164\145picker")); add_action("admin_print\137\163\143ripts-".$page5,array( &$this,"lmm_admin_enque\165\145\137scripts_jquer\171\144\141tepicker")); add_action("\141\144min_print_scr\151\160\164s-".$page7,array( &$this,"lmm_ad\155\151\156_bootstrap_t\141\142\163"),011); } function lmm_add_admin_bar_menu() { global $wp_version; $O4=get_option("\154eafletmapsmarke\162\137\157ptions"); $lk=( isset ($_GET["\160age"]) ? $_GET["\160age"]: ""); if ($lk == "leafl\145\164\155apsmarker_ma\162\153\145r") { $Ok="\043"; } else { $Ok=l1."admin.php?page=l\145\141\146letmapsmark\145\162\137marker"; } if ($O4["admin_bar_int\145\147\162ation"] == "enabled" && current_user_can($O4["capabilities_e\144\151\164"])) { global $wp_admin_bar; if ($O4["misc_whitelabel_b\141\143\153end"] == "enabled") { $ll=esc_attr__("M\141\160\163","lmm"); $lm=""; } else { $ll="\115aps Marker P\162\157"; $lm=array("\164\151tle" => "\127ordpress-Plugin\040".__("by","\154\155\155")." www.mapsmarker.com"); } if (version_compare($wp_version,"3.\070\055alpha",">")) { $Oi="-whi\164\145"; $Om="<spa\156\040\143lass=\042\141\142\055icon\042\076\074/span><spa\156\040\143lass=\042\141\142-label\042\076".$ll."</span>"; } else { $Om="\074\151mg style=\042\146loat:left;\155\141\162gin:3px 5px\040\060 0;\042 sr\143\075\042".O1."\151nc/img/icon-tiny\155\143\145.png\042/\076\040".$ll; $Oi=""; } $menu_items=array(array("\151d" => "lmm","\164itle" => $Om,"href" => "","m\145\164\141" => $lm),array("id" => "lmm-markers","\160arent" => "lmm","\164itle" => "\074img src=\042".O1."\151\156c/img/icon-me\156\165\055list".$Oi."\056\160ng\042> ".__("List all markers","\154mm"),"href" => l1."\141\144min.php?page=lea\146\154\145tmapsmarker\137\155\141rkers"),array("\151\144" => "lmm-add-marker","\160\141rent" => "lmm","\164\151tle" => "\074img src=\042".O1."\151\156c/img/icon-menu-\141\144\144".$Oi."\056\160\156g\042> ".__("\101\144d new marker","\154\155m"),"\150\162ef" => $Ok),array("id" => "\154\155\155-import-export","parent" => "\154\155m","\164\151tle" => "\074img src=\042".O1."\151\156c/img/icon-menu-im\160\157\162t-export".$Oi."\056png\042> ".__("\111\155port/Export","\154\155m"),"href" => l1."admin.ph\160\077\160age=leaflet\155\141\160smarker_imp\157\162\164_export"),array("id" => "lmm\055\154\141yers","\160arent" => "lmm","\164\151tle" => "\074\151mg src=\042".O1."\151\156c/img/icon-menu-l\151\163\164".$Oi.".png\042\076\040".__("List all layers","\154\155m"),"\150\162\145f" => l1."\141\144\155in.php?page=le\141\146\154etmapsmark\145\162\137layers"),array("id" => "lmm-\141\144\144-layers","\160arent" => "lmm","\164\151tle" => "\074\151\155g src=\042".O1."\151nc/img/icon-menu\055\141\144d".$Oi.".png\042\076\040".__("\101dd new layer","\154\155m"),"href" => l1."admin\056\160\150p?page=leaf\154\145\164mapsmarker_l\141\171\145r")); if (current_user_can("\141ctivate_plugins") && ($O4["\155\151sc_whitelab\145\154\137backend"] == "disab\154\145\144")) { $menu_items=array_merge($menu_items,array(array("\151d" => "lmm-t\157\157\154s","\160\141rent" => "lmm","\164\151\164le" => "<hr style=\042\155\141\162gin:3px 0\073\042\040noshade s\151\172\145=\0421\042\057><img src=\042".O1."inc/img/icon\055\155\145nu-tools".$Oi."\056png\042> ".__("\124ools","\154\155m"),"\150\162ef" => l1."\141\144\155in.php?page=le\141\146\154etmapsmarke\162\137\164ools"),array("\151\144" => "lmm-settings","\160arent" => "lmm","\164\151\164le" => "\074img src=\042".O1."\151\156c/img/icon-menu-s\145\164\164ings".$Oi."\056\160\156g\042> ".__("\123ettings","l\155\155"),"href" => l1."admin.php?pag\145\075\154eafletmaps\155\141\162ker_setting\163"),array("\151d" => "lmm-\141\160\151","\160arent" => "\154\155\155","\164\151tle" => "\074\151mg src=\042".O1."\151nc/img/icon-men\165\055\141pi".$Oi."\056\160ng\042> Map\163\040\115arker API","href" => l1."admin\056\160\150p?page=leaf\154\145\164mapsmarker_\163\145\164tings#lmm\055\155isc-section9"))); } if ($O4["m\151\163\143_whitelabel\137\142\141ckend"] == "di\163\141\142led") { $menu_items=array_merge($menu_items,array(array("\151\144" => "lmm-help\055\143\162edits","parent" => "lmm","\164itle" => "\074img src=\042".O1."\151nc/img/icon-men\165\055\150elp".$Oi."\056\160ng\042> ".__("\123\165pport","l\155\155"),"href" => l1."admin.php?\160\141\147e=leafletmaps\155\141\162ker_help"),array("\151\144" => "lmm-license","parent" => "lmm","\164itle" => "\074hr style=\042\155\141\162gin:3px 0;\042\040\156oshade siz\145\075\0421\042\057\076<img src=\042".O1."\151nc/img/icon-me\156\165\055settings".$Oi."\056\160ng\042> ".__("\114\151\143ense settings","\154mm"),"href" => l1."a\144\155\151n.php?page=lea\146\154\145tmapsmarker\137\154\151cense"))); } foreach ($menu_items as $menu_item) { $wp_admin_bar->add_menu($menu_item); } } } function lmm_add_contextual_help() { $helptext="\074p>".__("\104\157\040you have que\163\164\151ons or issu\145\163\040with Lea\146\154\145t Maps Ma\162\153\145r? Plea\163\145\040use th\145\040following\040\163upport cha\156\156els approp\162\151\141tely.","lmm")."<br/>"; $helptext.="\074\163\164rong>".__("\102\145\146ore you post a\040\156\145w support \164\151\143ket, pleas\145\040\146ollow th\145\040\151nstruct\151\157\156s from \074\141\040href=\042\150\164tp://ww\167\056mapsmarker\056\143om/readme-f\151\162\163t\042\040\164arget=\042\137\142lank\042\076\150ttp://www\056\155\141psmark\145\162.com/read\155\145\055first\074\057a> which \147\151ve you a \147\165\151delin\145\040on how to\040\144eal wit\150\040the most\040\143ommon i\163\163ues.","l\155\155")."\074/strong></p>"; $helptext.="<ul>"; $helptext.="\074\154i><a href=\042\150\164\164ps://www.ma\160\163\155arker.com/\146\141\161/\042 \164\141\162get=\042\137\142lank\042>".__("FAQ","lmm")."\074/a> (".__("fre\161\165\145ntly asked que\163\164\151ons","\154mm")."\051\074/li>"; $helptext.="<li><a href\075\042https://www.ma\160\163\155arker.com/\144\157\143s/\042 \164\141\162get=\042\137\142\154ank\042\076".__("\104\157\143umentation","\154\155m")."\074/a></li>"; $helptext.="<li><a hre\146\075\042https://\167\167\167.mapsmarker.\143\157\155/login\042\040\164arget=\042\137\142lank\042\076\155apsmarker.\143\157\155/login\074\057a> (".__("\163\165pport for pro us\145\162\163","\154\155\155")."\051</li>"; $helptext.="\074\057ul>"; $screen=get_current_screen(); $screen->add_help_tab(array("id" => "\154\155\155_help_tab","title" => __("\110\145lp & Support","\154mm"),"\143\157\156tent" => $helptext)); } function lmm_admin_selectjs() { $l5=get_option("\154eafletmapsmarker_\166\145rsion_pro"); wp_enqueue_script(array("jquer\171")); wp_enqueue_script("leafletmapsmark\145\162\055select2",LEAFLET_PLUGIN_URL."\151\156\143/js/select2/\163\145\154ect2.min.js",array("jqu\145\162\171"),$l5); wp_enqueue_style("\154eafletmapsmark\145\162\055select2",LEAFLET_PLUGIN_URL."inc/j\163\057\163elect2/selec\164\062\056css",array(),$l5); wp_localize_script("\154eafletmapsma\162\153\145r-select2","mapsmarkerj\163\160\162o",array("\163\145ttings_search_\160\154\141ceholder" => __("start full-text\040\163\145arch","lmm"),"\163\145ttings_search\137\156\157_results" => __("\116\157 matches found","\154mm"),"\154\155\155_current_pa\147\145" => ( isset ($_GET["\160\141\147e"]) ? $_GET["page"]: ""))); } function lmm_admin_ajax_actionsjs() { $O4=get_option("leaflet\155\141psmarker_optio\156\163"); $l5=get_option("leafletmap\163\155\141rker_vers\151\157\156_pro"); wp_enqueue_script(array("jquery")); wp_enqueue_script("leafletmapsmarker-\141\152\141x-actions-j\163",O1."inc/js/ajax-action\163\056\152s",array("jquery"),$l5); wp_localize_script("lea\146\154\145tmapsmarker-a\152\141\170-actions-js","lmm_aj\141\170\137vars",array("\154mm_ajax_nonce" => wp_create_nonce("lmm-ajax-\156\157\156ce"),"\154\155m_ajax_current_p\141\147\145" => ( isset ($_GET["\160\141\147e"]) ? $_GET["page"]: ""),"\154\155\155_ajax_confirm\137\144\145lete" => esc_attr__("Do you r\145\141\154ly want to \144\145\154ete this ma\162\153\145r? (canno\164\040be undone)","\154mm"),"lmm_aja\170\137\163hortcode" => htmlspecialchars($O4["\163hortcode"]),"\154\155\155_ajax_leaflet\137\160\154ugin_url" => LEAFLET_PLUGIN_URL,"\154\155\155_ajax_admi\156\137\165rl" => l1,"\154mm_ajax_misc_km\154" => $O4["\155\151sc_kml"])); } function lmm_admin_bootstrap_tabs() { $l5=get_option("leafletmapsmarke\162\137\166ersion_pro"); wp_enqueue_script(array("\152\161uery")); wp_enqueue_script("leafletmap\163\155\141rker-bootst\162\141\160-tabs",LEAFLET_PLUGIN_URL."inc/js\057\142\157otstrap-tabs\056\155\151n.js",array("\152\161uery"),$l5); } function lmm_frontend_enqueue_scripts() { global $locale; $O4=get_option("\154eafletmapsmarker_o\160\164\151ons"); $l5=get_option("leafletmapsmarker\137\166\145rsion_pro"); $google_adsense_status=$O4["\147oogle_adse\156\163\145_status"]; if ($google_adsense_status == "enable\144") { $gmaps_libraries="&libraries=adsense"; } else { $gmaps_libraries=""; } if ($O4["\147\157ogle_maps_langua\147\145\137localization"] == "\142rowser_setting") { $google_language=""; } else if ($O4["google_maps_l\141\156\147uage_local\151\172\141tion"] == "\167\157rdpress_settin\147") { if ($locale != NULL) { $google_language="&language=".substr($locale,0,2); } else { $google_language="&language=en"; } } else { $google_language="\046\154anguage=".$O4["google_maps\137\154\141nguage_local\151\172\141tion"]; } if ($O4["google_maps_base_\144\157\155ain_custom"] == "") { $gmaps_base_domain="&base_domain=".$O4["\147\157ogle_maps_bas\145\137\144omain"]; } else { $gmaps_base_domain="&base_\144\157\155ain=".htmlspecialchars($O4["google_maps_base_do\155\141\151n_custom"]); } if ( isset ($O4["google_maps_api_ke\171"]) && ($O4["google_maps_api_k\145\171"] != NULL)) { $google_maps_api_key=$O4["\147\157ogle_maps_api_k\145\171"]; } else { $google_maps_api_key=""; } $ln=(is_ssl() == TRUE) ? "\150\164tps": "\150ttp"; if ($O4["\147\157ogle_maps_ap\151\137\163tatus"] == "e\156\141\142led") { if ($O4["misc_javasc\162\151\160t_header_fo\157\164\145r_pro"] == "\146\157\157ter") { wp_register_script("leafletmaps\155\141\162ker-googlem\141\160\163-loader",$ln."://www.google.\143\157\155/jsapi?key=".$google_maps_api_key,array(),.37e1,TRUE); } else { wp_enqueue_script("\154\145afletmapsmar\153\145\162-googlemap\163\055\154oader",$ln."://www\056\147\157ogle.com/j\163\141\160i?key=".$google_maps_api_key,array(),.37e1,TRUE); } } $google_styling_json=($O4["\147\157ogle_styling_json"] == NULL) ? "\144\151sabled": str_replace("\042","\047",$O4["\147\157ogle_styling_js\157\156"]); if ($O4["\142\151ngmaps_cultu\162\145"] == "\141\165tomatic") { if ($locale != NULL) { $bing_culture=str_replace("\137","-",$locale); } else { $bing_culture="en_\165\163"; } } else { $bing_culture=$O4["\142ingmaps_culture"]; } if ($O4["\147oogle_maps_api_st\141\164\165s"] == "enabled") { if ($O4["\155\151\163c_javascript_\150\145\141der_footer_\160\162\157"] == "foo\164\145\162") { wp_register_script("\154\145afletmapsmarker-co\162\145",O1."\154eaflet-dist/le\141\146\154et-core.js",array("leafletmapsm\141\162\153er-googlemap\163\055\154oader"),$l5,FALSE); wp_register_script("\154eafletmapsmarke\162\055\141ddons",O1."leaflet-dist/l\145\141\146let-addons\056\152\163",array("\154eafletmapsmarker-\143\157\162e"),$l5,FALSE); wp_register_script("sho\167\137\155ap",O1."\151\156c/js/show_map.js",array("leafletmapsmarker\055\143\157re","\154\145afletmapsmar\153\145\162-addons"),$l5,FALSE); } else { wp_enqueue_script("leafletma\160\163\155arker-core",O1."\154eaflet-dist/leafle\164\055\143ore.js",array("\154eafletmapsmark\145\162\055googlemaps-l\157\141\144er"),$l5,FALSE); wp_enqueue_script("\154eafletmapsmarke\162\055\141ddons",O1."\154\145aflet-dist/lea\146\154\145t-addons.js",array("leafletmaps\155\141\162ker-core"),$l5,FALSE); } } else { if ($O4["misc_javascrip\164\137\150eader_foot\145\162\137pro"] == "f\157\157\164er") { wp_register_script("lea\146\154\145tmapsmarker-co\162\145",O1."leaflet-di\163\164\057leaflet-co\162\145\056js",array(),$l5,FALSE); wp_register_script("leafletmapsmarker-\141\144\144ons",O1."\154eaflet-dist/le\141\146\154et-addons.j\163",array("\154\145\141fletmapsmark\145\162\055core"),$l5,FALSE); wp_register_script("\163how_map",O1."inc/js/sh\157\167\137map.js",array("\154eafletmapsmarker\055\143\157re","\154eafletmapsmark\145\162\055addons"),$l5,FALSE); } else { wp_enqueue_script("leafletmapsmarker\055\143\157re",O1."\154\145aflet-dist/l\145\141\146let-core.js",array(),$l5,FALSE); wp_enqueue_script("leafletmapsmark\145\162\055addons",O1."\154eaflet-dist/lea\146\154\145t-addons.js",array("leafletmapsmarker-\143\157\162e"),$l5,FALSE); } } if ($google_adsense_status == "\144\151\163abled") { wp_localize_script("\154\145afletmapsmarker-\143\157\162e","mapsmarkerjspro",array("zoom_\151\156" => __("Zoom in","lmm"),"zo\157\155\137out" => __("\132oom out","lmm"),"go\157\147\154emaps_language" => $google_language,"googlema\160\163\137libraries" => $gmaps_libraries,"googlemaps_base_\144\157\155ain" => $gmaps_base_domain,"\142ing_culture" => $bing_culture,"\147\157ogle_adsense_st\141\164\165s" => $google_adsense_status,"\147oogle_styling_j\163\157\156" => $google_styling_json,"\155\151nimap_show" => __("Show min\151\155\141p","lmm"),"mi\156\151\155ap_hide" => __("\110ide minimap","\154\155m"),"minimap_s\164\141\164us" => $O4["minimap_sta\164\165\163"],"\146\165llscreen_button\137\164\151tle" => __("\126\151\145w fullscreen","\154\155m"),"fullsc\162\145\145n_button_titl\145\137\145xit" => __("Exit fullscreen","\154mm"),"fullscreen_\142\165\164ton_position" => $O4["map_fu\154\154\163creen_button\137\160\157sition"],"maxzoom" => intval($O4["\147\154obal_maxzoom_leve\154"]),"google_map\163\137\141pi_status" => $O4["google_maps_api_\163\164\141tus"],"\155eters" => __("\155\145ters","lmm"),"feet" => __("feet","lmm"))); } else { $google_adsense_format=$O4["goo\147\154\145_adsense_form\141\164"]; $google_adsense_position=$O4["google_\141\144\163ense_position"]; $google_adsense_backgroundColor=htmlspecialchars($O4["\147\157ogle_adsense_bac\153\147\162oundColor"]); $google_adsense_borderColor=htmlspecialchars($O4["goo\147\154\145_adsense_bord\145\162\103olor"]); $google_adsense_titleColor=htmlspecialchars($O4["\147oogle_adse\156\163\145_borderColo\162"]); $google_adsense_textColor=htmlspecialchars($O4["\147\157ogle_adsense\137\164\145xtColor"]); $google_adsense_urlColor=htmlspecialchars($O4["google_adsense\137\165\162lColor"]); $google_adsense_channelNumber=htmlspecialchars($O4["g\157\157\147le_adsense_cha\156\156\145lNumber"]); $google_adsense_publisherId=htmlspecialchars($O4["go\157\147\154e_adsense_pub\154\151\163herId"]); wp_localize_script("leafletmapsma\162\153\145r-core","\155\141psmarkerjspro",array("\172\157\157m_in" => __("Zoom in","\154\155\155"),"zoom_out" => __("\132\157om out","\154\155\155"),"g\157\157\147lemaps_language" => $google_language,"\147ooglemaps_li\142\162\141ries" => $gmaps_libraries,"\147ooglemaps_base\137\144\157main" => $gmaps_base_domain,"bing_culture" => $bing_culture,"go\157\147\154e_adsense_statu\163" => $google_adsense_status,"google_\141\144\163ense_format" => $google_adsense_format,"google_ad\163\145\156se_position" => $google_adsense_position,"\147oogle_adsense\137\142\141ckgroundColo\162" => $google_adsense_backgroundColor,"\147\157\157gle_adsense_\142\157\162derColor" => $google_adsense_borderColor,"goog\154\145\137adsense_title\103\157\154or" => $google_adsense_titleColor,"google_adsense_te\170\164\103olor" => $google_adsense_textColor,"google_ads\145\156\163e_urlColor" => $google_adsense_urlColor,"\147oogle_adsense\137\143\150annelNumber" => $google_adsense_channelNumber,"google_ad\163\145\156se_publisher\111\144" => $google_adsense_publisherId,"\147\157ogle_styling\137\152\163on" => $google_styling_json,"\155\151nimap_show" => __("Show \155\151\156imap","\154\155\155"),"min\151\155\141p_hide" => __("\110ide minimap","\154\155\155"),"minimap\137\163\164atus" => $O4["minimap_status"],"\146ullscreen_button_t\151\164\154e" => __("View ful\154\163\143reen","\154\155\155"),"full\163\143\162een_button_tit\154\145\137exit" => __("\105\170\151t fullscreen","\154\155m"),"fullscreen_\142\165\164ton_position" => $O4["ma\160\137\146ullscreen_butt\157\156\137position"],"maxzoom" => intval($O4["global_maxzoo\155\137\154evel"]),"\147\157ogle_maps_api_s\164\141\164us" => $O4["\147oogle_maps_api_s\164\141\164us"],"meters" => __("\155eters","lmm"),"feet" => __("\146eet","lmm"))); } } function lmm_admin_enqueue_scripts() { global $wp_version,$locale; $O4=get_option("\154\145afletmapsmarker_\157\160\164ions"); $l5=get_option("leafletmapsm\141\162\153er_version_\160\162\157"); $google_adsense_status=$O4["\147\157ogle_adsense_st\141\164\165s"]; if ($google_adsense_status == "enabled") { $gmaps_libraries="&librar\151\145\163=places,adse\156\163\145"; } else { $gmaps_libraries="&librar\151\145\163=places"; } if ($locale != NULL) { $lang=substr($locale,0,2); } else { $lang="en"; } if ($O4["google_ma\160\163\137language_loc\141\154\151zation"] == "br\157\167\163er_setting") { $google_language=""; } else if ($O4["google_maps\137\154\141nguage_loca\154\151\172ation"] == "\167\157\162dpress_settin\147") { if ($locale != NULL) { $google_language="&language=".substr($locale,0,2); } else { $google_language="\046\154anguage=en"; } } else { $google_language="\046\154\141nguage=".$O4["\147\157ogle_maps_langu\141\147\145_localizatio\156"]; } if ($O4["\147\157\157gle_maps_ba\163\145\137domain_custom"] != "") { $gmaps_base_domain="\046base_domain=".$O4["goo\147\154\145_maps_base_do\155\141\151n"]; } else { $gmaps_base_domain="&base_\144\157\155ain=".htmlspecialchars($O4["g\157\157\147le_maps_base_\144\157\155ain_custom"]); } wp_enqueue_script(array("jque\162\171")); $page=( isset ($_GET["\160\141ge"]) ? $_GET["page"]: ""); if ($page == "leaf\154\145\164mapsmarker_\154\141\171er") { if (version_compare($wp_version,"3.5","\076\075")) { wp_enqueue_media(); } else { wp_enqueue_style("thickbox"); wp_enqueue_script("\155\145dia-upload"); wp_enqueue_script("thickbox"); wp_enqueue_script("\155\145dia-models"); } } if ( isset ($O4["\147\157ogle_maps_api\137\153\145y"]) && ($O4["\147oogle_maps\137\141\160i_key"] != NULL)) { $google_maps_api_key=$O4["google_maps_a\160\151\137key"]; } else { $google_maps_api_key=""; } $ln=(is_ssl() == TRUE) ? "htt\160\163": "http"; if ($O4["google_places_s\164\141\164us"] == "enabled") { wp_enqueue_script("leafletm\141\160\163marker-googl\145\155\141ps-loader",$ln."\072//www.google.c\157\155\057jsapi?key=".$google_maps_api_key,array(),.37e1,TRUE); } $google_styling_json=($O4["google_styling_\152\163\157n"] == NULL) ? "disabled": str_replace("\042","'",$O4["\147\157\157gle_styling_j\163\157\156"]); if ($O4["\142ingmaps_culture"] == "automatic") { if ($locale != NULL) { $bing_culture=str_replace("_","-",$locale); } else { $bing_culture="en_us"; } } else { $bing_culture=$O4["\142ingmaps_cultur\145"]; } if ($O4["google_place\163\137\163tatus"] == "enabled") { wp_enqueue_script("\154\145afletmapsmar\153\145\162-core",O1."leaflet-di\163\164\057leaflet-cor\145\056\152s",array("leafletmapsmarker\055\147\157oglemaps-loa\144\145\162"),$l5,FALSE); wp_enqueue_script("\154eafletmapsmark\145\162\055addons",O1."\154eaflet-dist/\154\145\141flet-addons.\152\163",array("\154\145afletmapsmar\153\145\162-core"),$l5,FALSE); $On="enab\154\145\144"; } else { wp_enqueue_script("leafletmapsmar\153\145\162-core",O1."leaflet-dist/le\141\146\154et-core.js",array(),$l5,FALSE); wp_enqueue_script("leafletmapsmarke\162\055\141ddons",O1."\154\145aflet-dist/\154\145\141flet-addons.\152\163",array("\154\145afletmapsmark\145\162\055core"),$l5,FALSE); $On="disabled"; } if ($google_adsense_status == "\144\151sabled") { wp_localize_script("leafletma\160\163\155arker-core","\155apsmarkerjspro",array("zoom_in" => __("Zoom in","\154\155m"),"zoom\137\157\165t" => __("\132oom out","l\155\155"),"\147ooglemaps_langu\141\147\145" => $google_language,"\147ooglemaps_libra\162\151\145s" => $gmaps_libraries,"\147ooglemaps_base_dom\141\151\156" => $gmaps_base_domain,"\142\151\156g_culture" => $bing_culture,"google_adsense_\163\164\141tus" => $google_adsense_status,"google_styling_j\163\157\156" => $google_styling_json,"\155inimap_show" => __("Show minimap","\154\155\155"),"minimap\137\150\151de" => __("Hide minimap","l\155\155"),"minimap_statu\163" => $O4["\155\151\156imap_status"],"fullscreen\137\142\165tton_title" => __("\126\151\145w fullscreen","\154mm"),"fullscre\145\156\137button_title\137\145\170it" => __("Exit f\165\154\154screen","\154\155m"),"fullscreen\137\142\165tton_position" => $O4["map_f\165\154\154screen_button\137\160\157sition"],"maxzoom" => intval($O4["\147lobal_maxzoom\137\154\145vel"]),"\147\157\157gle_maps_ap\151\137\163tatus" => $On,"\155eters" => __("\155\145ters","lmm"),"feet" => __("\146eet","\154mm"))); } else { $google_adsense_format=$O4["googl\145\137\141dsense_format"]; $google_adsense_position=$O4["goog\154\145\137adsense_posit\151\157\156"]; $google_adsense_backgroundColor=htmlspecialchars($O4["google_adsen\163\145\137backgroundC\157\154\157r"]); $google_adsense_borderColor=htmlspecialchars($O4["\147\157ogle_adsense_bo\162\144\145rColor"]); $google_adsense_titleColor=htmlspecialchars($O4["google_a\144\163\145nse_borderCo\154\157\162"]); $google_adsense_textColor=htmlspecialchars($O4["\147oogle_adsense_t\145\170\164Color"]); $google_adsense_urlColor=htmlspecialchars($O4["\147\157\157gle_adsense_u\162\154\103olor"]); $google_adsense_channelNumber=htmlspecialchars($O4["google_adsense_ch\141\156\156elNumber"]); $google_adsense_publisherId=htmlspecialchars($O4["\147oogle_adsense_p\165\142\154isherId"]); wp_localize_script("leafletmapsma\162\153\145r-core","\155apsmarkerjspro",array("\172\157\157m_in" => __("Zoom i\156","\154\155m"),"zoom_out" => __("Zoom out","lmm"),"go\157\147\154emaps_language" => $google_language,"google\155\141\160s_libraries" => $gmaps_libraries,"googlemaps_base_\144\157\155ain" => $gmaps_base_domain,"\142ing_culture" => $bing_culture,"google_\141\144\163ense_status" => $google_adsense_status,"\147oogle_adsens\145\137\146ormat" => $google_adsense_format,"g\157\157\147le_adsense_posi\164\151\157n" => $google_adsense_position,"google_adsense_ba\143\153\147roundColor" => $google_adsense_backgroundColor,"\147\157\157gle_adsense_b\157\162\144erColor" => $google_adsense_borderColor,"google_ads\145\156\163e_titleColor" => $google_adsense_titleColor,"g\157\157\147le_adsense_text\103\157\154or" => $google_adsense_textColor,"google_adsense_u\162\154\103olor" => $google_adsense_urlColor,"google_adsense_ch\141\156\156elNumber" => $google_adsense_channelNumber,"\147oogle_adsens\145\137\160ublisherId" => $google_adsense_publisherId,"go\157\147\154e_styling_json" => $google_styling_json,"minimap_show" => __("\123how minimap","\154\155m"),"minimap_h\151\144\145" => __("Hide minimap","lmm"),"minimap\137\163\164atus" => $O4["\155inimap_statu\163"],"fullscreen_\142\165\164ton_title" => __("\126\151ew fullscreen","lmm"),"\146ullscreen_b\165\164\164on_title_exi\164" => __("\105xit fullscreen","lmm"),"fu\154\154\163creen_button_po\163\151\164ion" => $O4["map_fullscreen_\142\165\164ton_position"],"maxzoom" => intval($O4["global_maxzo\157\155\137level"]),"\147oogle_maps_a\160\151\137status" => $On,"\155eters" => __("\155eters","lmm"),"\146\145et" => __("f\145\145\164","lmm"))); } } function lmm_admin_enqueue_scripts_jquerydatepicker() { $l5=get_option("\154\145afletmapsmarker\137\166\145rsion_pro"); wp_enqueue_script("jquery-ui-tim\145\160\151cker-addon",O1."inc/js\057\152query-ui-timepick\145\162\055addon.js",array("jquery","jquery-ui-t\141\142\163","jquer\171\055\165i-datepicker","\152query-ui-slider"),$l5); } function lmm_frontend_enqueue_stylesheets() { $O4=get_option("leafletmap\163\155\141rker_option\163"); global $wp_query; $posts=$wp_query->posts; $pattern=get_shortcode_regex(); $l5=get_option("\154eafletmapsmark\145\162\137version_pro"); if (function_exists("is_rtl") && is_rtl()) { $lo="\154\145\141fletmapsmark\145\162\055rtl"; $Oo="leaflet-\162\164\154.min.css"; } else { $lo="leaf\154\145\164mapsmarker"; $Oo="\154\145aflet.min.css"; } wp_register_style($lo,O1."\154\145\141flet-dist/".$Oo,array(),$l5); if (is_array($posts)) { foreach ($posts as $post) { if (preg_match_all("\057".$pattern."/s",$post->post_content ,$matches) && array_key_exists(2,$matches) && in_array($O4["s\150\157\162tcode"],$matches[2])) { wp_enqueue_style($lo); break; } } $lmm_custom_css="\056leaflet-popup\055\143\157ntent img \173\040".htmlspecialchars($O4["defaul\164\163\137marker_popups\137\151\155age_css"])."\040} .marker-clu\163\164\145r-small \173\040\142ackground-co\154\157\162: ".htmlspecialchars($O4["cluste\162\151\156g_color_smal\154"])."\073 } .marker-clus\164\145\162-small div \173\040\142ackground-\143\157\154or: ".htmlspecialchars($O4["c\154\165\163tering_color_s\155\141\154l_inner"])."\073\040color: ".htmlspecialchars($O4["cluster\151\156\147_color_small\137\164\145xt"])."\073\040\175 .marker-clus\164\145\162-medium \173\040\142\141ckgroun\144\055\143olor: ".htmlspecialchars($O4["clustering_\143\157\154or_medium"])."; } .mar\153\145\162-cluster-mediu\155\040\144iv \173 \142\141\143kground-\143\157\154or: ".htmlspecialchars($O4["clustering_color\137\155\145dium_inner"])."\073\040 color: ".htmlspecialchars($O4["clustering_co\154\157\162_medium_text"])."\073\040} .marker-cluste\162\055\154arge \173 \142\141\143kground-c\157\154\157r: ".htmlspecialchars($O4["clustering_co\154\157\162_large"])."; }\040\056\155arker-cluster-\154\141\162ge div \173\040\142ackground-col\157\162\072 ".htmlspecialchars($O4["clusteri\156\147\137color_large_i\156\156\145r"]).";  color: ".htmlspecialchars($O4["clustering_color_l\141\162\147e_text"])."; }"; wp_add_inline_style($lo,$lmm_custom_css); } } function lmm_template_check_shortcode($template) { $O4=get_option("le\141\146\154etmapsmarker_\157\160\164ions"); $searchterm="[".$O4["shortcode"]; $files=array($template,get_stylesheet_directory().DIRECTORY_SEPARATOR."he\141\144\145r.php",get_stylesheet_directory().DIRECTORY_SEPARATOR."footer.p\150\160"); if (function_exists("\151s_rtl") && is_rtl()) { $lo="l\145\141\146letmapsmarker-\162\164\154"; $Oo="\154\145aflet-rtl.min.c\163\163"; } else { $lo="\154eafletmapsmarker"; $Oo="\154\145aflet.min.css"; } foreach ($files as $file) { if (file_exists($file)) { $contents=file_get_contents($file); if (strpos($contents,$searchterm)) { $l5=get_option("\154\145afletmapsmark\145\162\137version_pro"); wp_register_style($lo,O1."\154eaflet-dist/".$Oo,array(),$l5); wp_enqueue_style($lo); break; } } } return $template; } function lmm_admin_enqueue_stylesheets() { $l5=get_option("leafletmapsma\162\153er_version_pro"); if (function_exists("\151\163\137rtl") && is_rtl()) { wp_register_style("le\141\146\154etmapsmarker-a\144\155\151n-rtl",O1."inc/css/lea\146\154\145tmapsmarker-\141\144\155in-rtl.css",array(),$l5); wp_enqueue_style("lea\146\154etmapsmarker-\141\144\155in-rtl"); } else { wp_register_style("leafletmapsmarker\055\141\144min",O1."\151nc/css/leafletm\141\160\163marker-admin\056\143\163s",array(),$l5); wp_enqueue_style("leafle\164\155\141psmarker-admi\156"); } } function lmm_admin_enqueue_stylesheets_leaflet() { global $wp_version; $l5=get_option("\154\145afletmapsmar\153\145\162_version_pro"); if (function_exists("\151s_rtl") && is_rtl()) { $lo="leafletmapsmark\145\162\055rtl"; $Oo="\154eaflet-rtl.min.\143\163\163"; } else { $lo="\154eafletmapsmarker"; $Oo="\154\145aflet.min.css"; } wp_register_style($lo,O1."leaflet\055\144\151st/".$Oo,array(),$l5); wp_enqueue_style($lo); if (version_compare($wp_version,"\063\0567",">=")) { $O4=get_option("\154eafletmapsmar\153\145\162_options"); $lmm_custom_css=".leaf\154\145\164-popup-conten\164\040\151mg \173 ".htmlspecialchars($O4["\144\145faults_marker_pop\165\160\163_image_css"])."\040\175 .marker-clu\163\164\145r-small \173\040\142ackground-col\157\162\072 ".htmlspecialchars($O4["clustering_colo\162\137\163mall"])."; } .\155\141\162ker-cluster-sm\141\154\154 div \173\040\142\141ckground-\143\157\154or: ".htmlspecialchars($O4["clust\145\162\151ng_color_small\137\151\156ner"]).";\040\143\157lor: ".htmlspecialchars($O4["clustering_c\157\154\157r_small_tex\164"])."\073\040} .marker-cl\165\163\164er-medium \173\040\142ackground-co\154\157\162: ".htmlspecialchars($O4["clusteri\156\147\137color_medium"])."; \175\040\056marker-clus\164\145\162-medium div \173\040\142ackground\055\143\157lor: ".htmlspecialchars($O4["clustering\137\143\157lor_medium_inn\145\162"])."; color: ".htmlspecialchars($O4["clustering_\143\157\154or_medium_\164\145\170t"])."; } .marke\162\055\143luster-larg\145\040\173 backgroun\144\055\143olor: ".htmlspecialchars($O4["clusterin\147\137\143olor_large"])."; } .mar\153\145\162-cluster-larg\145\040\144iv \173 ba\143\153\147round-col\157\162\072 ".htmlspecialchars($O4["clustering_color\137\154\141rge_inner"])."\073\040color: ".htmlspecialchars($O4["clustering_c\157\154\157r_large_tex\164"])."\073 }"; wp_add_inline_style($lo,$lmm_custom_css); } } function lmm_admin_enqueue_stylesheets_datepicker() { $l5=get_option("\154\145afletmapsmarker_\166\145\162sion_pro"); wp_register_style("leafletmapsmarke\162\055\152query-ui-c\165\163\164om",O1."\151nc/css/jquery\055\144\141tepicker-the\155\145\057jquery-ui\055\143\165stom.css",array(),$l5); wp_enqueue_style("leafle\164\155\141psmarker-jquer\171\055\165i-custom"); } function lmm_admin_enqueue_stylesheets_adminbar() { $O4=get_option("\154eafletmapsma\162\153\145r_options"); if ($O4["\141\144\155in_bar_integ\162\141\164ion"] == "enabl\145\144" && current_user_can($O4["capabiliti\145\163\137edit"])) { $l5=get_option("leafletmapsmarker_\166\145\162sion_pro"); wp_register_style("leafletmap\163\155\141rker-admin-a\144\155\151nbar",O1."inc/css/leaflet\155apsmarker-admin-\141\144\155inbar.css",array(),$l5); wp_enqueue_style("leafletmaps\155\141\162ker-admin-\141\144\155inbar"); } } function lmm_install_and_updates() { $current_version="vp24"; $schedule_transient="\154\145\141fletmapsmar\153\145\162_install_upd\141\164\145_cache_".$current_version; $install_update_schedule=get_transient($schedule_transient); if ($install_update_schedule === FALSE) { $schedule_transient="\154\145afletmapsmar\153\145\162_install_up\144\141\164e_cache_".$current_version; set_transient($schedule_transient,"\145\170ecute install a\156\144\040update-rout\151\156\145 only onc\145\040\141 day",074*074*030); include ("\151nc".DIRECTORY_SEPARATOR."\151\156\163tall-and-upd\141\164\145s.php"); } } function lmm_plugin_meta_links() { define( "FB_BASENAME" ,plugin_basename( __FILE__)); define( "FB_BASEFOLDER" ,plugin_basename(dirname( __FILE__))); define( "FB_FILENAME" ,str_replace(FB_BASEFOLDER."\057","",plugin_basename( __FILE__))); function leafletmapsmarker_filter_plugin_meta($links,$file) { if ($file == FB_BASENAME) { array_unshift($links,"<a href=\042".l1."admin.php?page=l\145\141\146letmapsmar\153\145\162_markers\042\076".__("Markers","lmm")."</a>","<\141\040\150ref=\042".l1."\141\144min.php?page=\154\145\141fletmapsmarke\162\137\154ayers\042\076".__("Layers","\154\155\155")."</a>","<a href=\042".l1."\141\144min.php?page=\154\145\141fletmapsmark\145\162\137settings\042\076".__("\123ettings","\154\155\155")."\074/a>","\074a href=\042".l1."\141\144\155in.php?page=l\145\141\146letmapsmarke\162\137\154icense\042\076".__("\114icense","lmm")."</a>"); } return $links; } add_filter("p\154\165\147in_action_link\163","leafletmaps\155\141\162ker_filter_pl\165\147\151n_meta",012,2); } } if (is_admin()) { $lk= isset ($_GET["page"]) ? $_GET["page"]: ""; $lp=array("\154\145afletmapsmark\145\162\137markers","leafletmapsmar\153\145\162_marker","\154eafletmapsmar\153\145\162_import_expo\162\164","\154eafletmapsmarke\162\137\154ayers","\154\145afletmapsmarker_\154\141\171er","\154\145afletmapsmarker_\164\157\157ls","\154\145afletmapsmarker_s\145\164\164ings"); if ((in_array($lk,$lp)) && (O3() === FALSE)) { if (Op() !== TRUE) { exit (header("\114\157cation: ".l1."\141\144min.php?page=l\145\141\146letmapsmar\153\145\162_license")); } if (la($Oa=l0,$lb=FALSE) === FALSE) { $lq=array("\154\145\141fletmapsmar\153\145\162_markers","\154eafletmapsmark\145\162_marker","\154\145afletmapsmarke\162\137\151mport_expo\162\164","\154eafletmapsmark\145\162\137layers","\154eafletmapsmarker\137\154\141yer","\154\145afletmapsmar\153\145\162_tools","\154\145afletmapsmarke\162\137\163ettings"); if (in_array($lk,$lq)) { echo "\074script type=\042\164\145xt/javascript\042\076window.locat\151\157n.href = \042".l1."\141\144\155in.php?pag\145\075\154eafletmap\163\155\141rker_lic\145\156\163e&error=le\042\073</script> \040"; } } } } function Oq($lr,$is_theme=FALSE) { $ls=""; if ( isset ($_GET["\160\141ge"])) { $ls=$_GET["\160\141ge"]; } elseif ( isset ($_POST["page"])) { $ls=$_POST["page"]; } $Os=in_array($ls,$lr); if ($is_theme) { return $Os; } $lt=in_array(plugin_basename( __FILE__),get_option("\141\143tive_plugins")); return ($Os && $lt); } function Op($Ot=FALSE) { $lu=new Ou; $lu->lv ="\144\141\164abase"; $lu->Ov =array("l\157\143\141l_key" => get_option("\154\145\141fletmapsmark\145\162\160ro_license_l\157\143\141l_key")); $lu->lw =array("function" => "\165\160date_option","key" => "\154\145\141fletmapsma\162\153\145rpro_licens\145\137\154ocal_key"); $lu->Ow ="1,2,3,4,5,6,7,\070\0549,10"; $lu->lx =get_option("leafletmapsmarke\162\160\162o_license_\153\145\171"); $lu->Ox ="\067ca99e156b5e\063\060e0648f49b81178\143\144\067e"; $lu->ly ="https://www\056\155\141psmarker.co\155\057\163tore/api/\151\156\144ex.php"; $lu->validate(); if ($Ot) { return $lu; } $lr=array("\154\145afletmapsma\162\153\145r_markers","leafletmaps\155\141\162ker_marker","leafletmapsmark\145\162\137import_export","leafletmapsma\162\153\145r_layers","\154\145afletmapsmar\153\145\162_layer","\154eafletmapsmarke\162\137\164ools","\154eafletmapsmarker\137\163\145ttings"); if (is_admin() && Oq($lr,TRUE) && $lu->Oy) { return $lu->Oy; } return TRUE; } function la($Oa=FALSE,$lb=FALSE) { $lu=new Ou; if ($Oa !== FALSE) { $lu->Oa =strrev(substr($Oa,1,012)); } $lu->lv ="\144\141tabase"; $lu->Ov =array("\154ocal_key" => get_option("\154\145afletmapsmarker\160\162\157_license_loc\141\154\137key")); $lu->lw =array("\146unction" => "update_opt\151\157\156","\153ey" => "leafle\164\155\141psmarkerpro_\154\151\143ense_local_\153\145\171"); $lu->Ow ="\061,2,3,4,5,6,7,8\054\071\05410"; $lu->lx =get_option("leafletmapsmarker\160\162\157_license_\153\145\171"); $lu->Ox ="\067\143a99e156b5e30e0\066\064\070f49b81178\143\144\067e"; $lu->ly ="https://www.maps\155\141\162ker.com/st\157\162\145/api/index\056\160\150p"; $lu->validate(); if ($lb !== FALSE) { if ($lu->Oy) { return FALSE; } else { return TRUE; } } if ($lu->Oy) { return FALSE; } if ($Oa === FALSE) { $lz=$lu->Oz["\144\157wnload_access\137\145\170pires"]; $l10=$lu->Oz["su\160\160\157rt_access_ex\160\151\162es"]; $O10=abs(($lz>$l10) ? $lz: $l10); if (!l11()) { if ($lu->Oz["li\143\145\156se_expires"] == "never") { return FALSE; } if (time()>$lu->Oz["\154\151cense_expires"]) { return FALSE; } return TRUE; } return ($O10>time()) ? TRUE: FALSE; } else if ($Oa !== FALSE) { $lz=$lu->Oz["do\167\156\154oad_access_e\170\160\151res"]; $l10=$lu->Oz["\163upport_acce\163\163\137expires"]; $O10=abs(($lz>$l10) ? $lz: $l10); if (!l11()) { if ($lu->Oz["license_expires"] == "never") { return FALSE; } if (time()>$lu->Oz["license_expir\145\163"]) { return FALSE; } return TRUE; } if ($lu->Oa >$O10) { return FALSE; } else { return TRUE; } } } function lmm_validate_license_info($release_date_info=FALSE,$license_only_info=FALSE) { $spbas_info=new Ou; if ($release_date_info !== FALSE) { $spbas_info->release_date_info =strrev(substr($release_date_info,1,012)); } $spbas_info->lv ="database"; $spbas_info->Ov =array("local_key" => get_option("leafletma\160\163\155arkerpro_l\151\143\145nse_local_\153\145\171")); $spbas_info->lw =array("fu\156\143\164ion" => "\165\160\144ate_option","key" => "leafletma\160\163\155arkerpro_lice\156\163\145_local_key"); $spbas_info->Ow ="\061\0542,3,4,5,6,7,8,9\054\061\060"; $spbas_info->lx =get_option("leafl\145\164\155apsmarkerpro\137\154\151cense_key"); $spbas_info->Ox ="7ca99e156b5e30e0\066\0648f49b81178cd7e"; $spbas_info->ly ="https://www.mapsma\162\153\145r.com/store\057\141\160i/index.ph\160"; $spbas_info->validate(); if ($license_only_info !== FALSE) { if ($spbas_info->Oy) { return FALSE; } else { return TRUE; } } if ($spbas_info->Oy) { return FALSE; } if ($release_date_info === FALSE) { $download_expires_info=$spbas_info->Oz["\144\157\167nload_access\137\145\170pires"]; $support_expires_info=$spbas_info->Oz["\163upport_access_ex\160\151\162es"]; $expires_info=abs(($download_expires_info>$support_expires_info) ? $download_expires_info: $support_expires_info); if (!l11()) { if ($spbas_info->Oz["\154icense_expires"] == "never") { return FALSE; } if (time()>$spbas_info->Oz["\154\151\143ense_expires"]) { return FALSE; } return TRUE; } return ($expires_info>time()) ? TRUE: FALSE; } else if ($release_date_info !== FALSE) { $download_expires_info=$spbas_info->Oz["download_access\137\145xpires"]; $support_expires_info=$spbas_info->Oz["supp\157\162\164_access_expi\162\145\163"]; $expires_info=abs(($download_expires_info>$support_expires_info) ? $download_expires_info: $support_expires_info); if (!l11()) { if ($spbas_info->Oz["li\143\145\156se_expires"] == "never") { return FALSE; } if (time()>$spbas_info->Oz["license_expir\145\163"]) { return FALSE; } return TRUE; } if ($spbas_info->Oa >$expires_info) { return FALSE; } else { return TRUE; } } } function l11($prefix="\115\141psMarkerPro-") { return substr(get_option("leafletmap\163\155\141rkerpro_lic\145\156\163e_key"),0,strlen($prefix)) == $prefix; } function lmm_pro_version_info($prefix="MapsM\141\162\153erPro-") { return substr(get_option("\154eafletmaps\155\141\162kerpro_lice\156\163\145_key"),0,strlen($prefix)) == $prefix; } function O11($prefix="MapsMark\145\162\120ro-5P-") { return substr(get_option("\154eafletmapsmark\145\162\160ro_license_\153\145\171"),0,strlen($prefix)) == $prefix; } function l12($prefix="\115apsMarkerPro-\062\065\120-") { return substr(get_option("\154eafletmapsmarker\160\162\157_license_key"),0,strlen($prefix)) == $prefix; } function O12($prefix="MapsMarkerPro-10\060\120\055") { return substr(get_option("\154\145afletmapsmarke\162\160\162o_license_ke\171"),0,strlen($prefix)) == $prefix; } function l13($prefix="MapsM\141\162\153erPro-250P-") { return substr(get_option("\154eafletmapsma\162\153\145rpro_licen\163\145\137key"),0,strlen($prefix)) == $prefix; } function O13($prefix="MapsMarkerPro-\065\0600P-") { return substr(get_option("leafletma\160\163\155arkerpro_lice\156\163\145_key"),0,strlen($prefix)) == $prefix; } function l14($prefix="\115apsMarkerPro\055\061000P-") { return substr(get_option("leafletmapsmarke\162\160\162o_license_ke\171"),0,strlen($prefix)) == $prefix; } function O14($attribute) { if ( isset ($_POST[$attribute]) && ($_POST[$attribute] == TRUE)) { return $_POST[$attribute]; } global $current_user; get_currentuserinfo(); switch ($attribute) { case "maps_marker_pro\137\146\151rst_name": return $current_user->user_firstname; case "maps_m\141\162\153er_pro_last_n\141\155\145": return $current_user->user_lastname; case "maps_marker_p\162\157\137email": return $current_user->user_email; } return ""; } function maps_marker_pro_license_activation_page() { if ( isset ($_POST["maps_mar\153\145\162_pro_regis\164\145\162_free"])) { $lu=new Ou; $l15=""; $O15=array(); if (!$_POST["maps_mark\145\162\137pro_first_n\141\155\145"]) { $O15[]=__("\120lease enter yo\165\162\040first name\040\164\157 continue.","\154mm"); } if (!$_POST["maps_marker\137\160\162o_last_name"]) { $O15[]=__("\120lease enter y\157\165\162 last name \164\157\040continue\056","\154mm"); } if (!$_POST["maps_marker_pro_e\155\141\151l"]) { $O15[]=__("\120lease enter you\162\040\145mail to con\164\151\156ue.","lmm"); } if (sanitize_email($_POST["\155\141ps_marker_pr\157\137\145mail"]) !== $_POST["maps_marker_pro_e\155\141\151l"]) { $O15[]=__("Please e\156\164\145r a valid em\141\151\154 to continu\145\040\050or get a\156\040\141nonymous\040\164\162ial lic\145\156\163e key)","\154\155m"); } if (!$_POST["\155\141ps_marker_pro_\164\157\163"]) { $O15[]=__("\131ou must agree \164\157\040the TOS to \143\157\156tinue.","lmm"); } if (empty($O15)) { $qs="mod=3rd_party&ta\163\153\075api&api_key\075\065\060a2094314\146\142\14382e712b3f9\142\062\061f00745&\145\155\141il=".urlencode(sanitize_email($_POST["\155aps_marker_pro_\145\155\141il"]))."\046first_name=".urlencode($_POST["\155\141\160s_marker_pro_f\151\162\163t_name"])."\046\154ast_name=".urlencode($_POST["maps_marker_pro\137\154\141st_name"])."&compan\171\137\156ame=".urlencode($_POST["\155aps_marker_p\162\157\137first_name"])."%\062\060".urlencode($_POST["m\141\160\163_marker_pro_l\141\163\164_name"])."\046\165\163ername=".strtolower(sanitize_user($_POST["\155aps_marker_pr\157\137\154ast_name"],$l16=TRUE).substr(sanitize_user($_POST["\155aps_marker_p\162\157\137first_name"],$l16=TRUE),0,1)); $O16=$lu->l17("h\164\164\160s://www.maps\155\141\162ker.com/sto\162\145\057api/index.\160\150\160",$qs); if (strtolower(substr($O16,0,021)) == "\143\157nnection error\072") { $O15[]=$O16; } else if (strtolower(substr($O16,0,5)) == "\145rror") { $O15[]=$O16; } else { $O16=json_decode($O16); update_option("leafletmapsm\141\162\153erpro_licens\145\137\153ey",$lu->lx =$O16[0]); update_option("leafletmapsmarke\162\160\162o_license_l\157\143\141l_key",""); update_option("\154\145\141fletmapsmark\145\162\160ro_license_k\145\171\137trial",$lu->lx =$O16[0]); $l15=__("Your \156\145\167 license was\040\162\145gistered \163\165\143cessfully\041","lmm"); } } } else if ( isset ($_POST["maps_marker_pro_\162\145\147ister_free_\141\156\157nym"])) { $lu=new Ou; $l15=""; $O15=array(); if (!$_POST["\155aps_marker_\160\162\157_tos"]) { $O15[]=__("\131\157\165 must agre\145\040\164o the TOS \164\157\040continu\145\056","lmm"); } if (empty($O15)) { $qs="\155\157\144=3rd_party&\164\141\163k=api&api_ke\171\075\1468b3782fef\062\065c3f68e809f62\061\144\06193063"; $O16=$lu->l17("\150\164tps://www.map\163\155\141rker.com/st\157\162\145/api/index.\160\150\160",$qs); if (strtolower(substr($O16,0,021)) == "con\156\145\143tion error:") { $O15[]=$O16; } else if (strtolower(substr($O16,0,5)) == "\145\162ror") { $O15[]=$O16; } else { $O16=json_decode($O16); update_option("leaf\154\145\164mapsmarkerpro\137\154\151cense_key",$lu->lx =$O16[0]); update_option("\154eafletmapsmar\153\145\162pro_license_\154\157\143al_key",""); update_option("leafletmapsmar\153\145\162pro_licens\145\137\153ey_trial",$lu->lx =$O16[0]); $l15=__("Your new license \167\141\163 registered\040\163\165ccessfully\041","\154mm"); } } } else { if (!function_exists("w\160\137\166erify_nonce")) { require_once (ABSPATH."wp-in\143\154\165des/pluggable\056\160\150p"); } $O17=( isset ($_POST["\155\141ps_marker_pro_l\151\143\145nse"]) && wp_verify_nonce($_POST["maps_marker_pro_l\151\143\145nse"],"\155\141ps_marker_pro_lice\156\163\145")); if ($O17) { update_option("leafle\164\155\141psmarkerpro_\154\151\143ense_local_\153\145\171",""); update_option("leafl\145\164\155apsmarkerpro\137\154\151cense_key",$_POST["l\145\141\146letmapsmarkerp\162\157\137license_key"]); } $lu=Op(TRUE); } include dirname( __FILE__)."/leaflet-lic\145\156\163e.php"; return TRUE; } class Ou { public $Oy; public $l18; public $lx; public $ly; public $O18; public $l19; public $lv; public $Ov; public $lw; public $O19; public $l1a; public $Ow; public $O1a; public $l1b; public $Oa; public $Oz; public $O1b; public $l1c; function Ou() { $this->Oy =FALSE; $this->l18 =""; $this->O18 =0120; $this->l19 =012; $this->O1c =array("\163pbas"); $this->l1d ="spbas"; $this->lv ="filesystem"; $this->Ow =0; $this->O1a =0; $this->Ov =FALSE; $this->lw =FALSE; $this->O19 =""; $this->l1a ="license.txt"; $this->l1b =FALSE; $this->Oa =FALSE; $this->l1c =FALSE; $this->Oz =array("\143ustom_fields" => array(),"\144ownload_acce\163\163\137expires" => 0,"\154icense_expires" => 0,"lo\143\141\154_key_expires" => 0,"sta\164\165\163" => "Invalid",); $this->O1b =array("\141\143\164ive" => __("\124his license \151\163\040active.","lmm"),"suspended" => sprintf(__("\105rror: This lic\145\156\163e has been s\165\163\160ended. T\150\151\163 usually \150\141\160pens when\040\163\157meone t\162\151es to regi\163\164\145r a sec\157\156\144 trial\040\154icense for\040\164\150e same\040\144omain. <a\040\150ref=\042\045\061s\042 \164\141rget=\042\137\142lank\042\076\120lease cl\151\143\153 here \164\157 get a no\156\055expiring\040\154icense f\157\162\040this\040\144omain.</\141\076","\154mm"),"\150\164tps://www.mapsmar\153\145\162.com/order"),"ex\160\151\162ed" => sprintf(__("\131\157ur free 30 \144\141\171 trial licen\163\145\040key has \145\170\160ired. <a h\162\145\146=\042%\061\163\042 targe\164\075\042_blan\153\042>Please p\165\162\143hase a \166\141lid pro li\143\145nse key to\040\143ontinue</a\076\056","lmm"),"\150ttps://www.mapsma\162\153\145r.com/order"),"pending" => __("Error: This li\143\145\156se is pend\151\156\147 review.","lmm"),"dow\156\154\157ad_access_exp\151\162\145d" => __("Error: T\150\151\163 version of t\150\145\040software \167\141\163 released\040\141\146ter you\162\040\144ownload\040\141ccess expi\162\145\144. Plea\163\145\040renew y\157\165\162 downl\157\141\144 and su\160\160ort access \157\162 downgrade\040\164o a previo\165\163 version.","lmm"),"missing_licens\145\137\153ey" => __("Pleas\145\040\145nter a licen\163\145\040key to con\164\151\156ue.","lmm"),"u\156\153\156own_local_key_t\171\160\145" => __("\105\162ror: An unknown\040\164\171pe of local\040\153\145y validat\151\157\156 was requ\145\163\164ed.","\154mm"),"\143\157\165ld_not_obtain\137\154\157cal_key" => sprintf(__("\105rror: a new loca\154\040\154icense key\040\143\157uld not \142\145\040obtained\056\040Please see \045\163\040for mo\162\145\040inform\141\164\151on","\154\155\155"),"<a href=\042\150\164tps://www.ma\160\163\155arker.com/c\157\156\156ect-error\163\042\040target\075\042_blank\042\076\155apsmarker.\143\157\155/connec\164\055errors</a>"),"m\141\170\151mum_grace_peri\157\144\137expired" => __("\105rror: The maxi\155\165\155 local lice\156\163\145 key grac\145\040period has e\170\160\151red.","\154\155m"),"local_key_t\141\155\160ering" => __("Error: The local\040\154\151cense key \150\141\163 been tamper\145\144\040with or \151\163\040invalid\056","lmm"),"local_key_inval\151\144\137for_locatio\156" => __("\105rror: The local l\151\143\145nse key is\040\151\156valid fo\162\040\164his loca\164\151\157n.","\154\155m"),"\155\151ssing_licens\145\137\146ile" => __("\105\162ror: Please \143\162\145ate the foll\157\167\151ng file (\141\156\144 directo\162\151\145s if the\171\040\144o not \145\170\151st alr\145\141\144y):<br \057\076\134r\134\156\074br />\134\162\134\156","lmm"),"\154\151\143ense_file_no\164\137\167ritable" => __("\105rror: Please\040\155\141ke the fol\154\157\167ing path wr\151\164\141ble:<br \057\076","\154\155m"),"\151\156valid_local_\153\145\171_storage" => __("\105\162ror: the local \153\145\171 storage on\040\143\154ear could\040\156\157t determ\151\156\145d.","\154\155\155"),"\143\157\165ld_not_save_lo\143\141\154_key" => __("Error: th\145\040\154ocal licens\145\040\153ey could no\164\040\163aved.","lmm"),"\154\151\143ense_key_strin\147\137\155ismatch" => __("Error:\040\124\150e local key \151\163\040invalid f\157\162\040this lic\145\156\163e.","lmm"),); $this->localization =array("\141\143tive" => __("\124his license is\040\141\143tive.","\154mm"),"suspended" => sprintf(__("\105rror: This license\040\150\141s been sus\160\145\156ded. This \165\163\165ally happ\145\156\163 when so\155\145\157ne tries\040\164o regist\145\162\040a seco\156\144\040trial \154\151\143ense f\157\162\040the s\141\155\145 domai\156\056 <a href=\042\0451s\042 \164\141\162get=\042\137\142lank\042\076\120lease c\154\151ck here t\157\040get a non\055\145xpiring l\151\143ense for \164\150\151s dom\141\151n.</a>","\154mm"),"\150\164tps://www.maps\155\141\162ker.com/order"),"expired" => sprintf(__("Your free 30 day t\162\151\141l license k\145\171\040has expire\144\056\040<a href=\042\0451s\042 tar\147\145\164=\042_\142\154\141nk\042\076\120lease pur\143\150\141se a v\141\154\151d pro l\151\143\145nse ke\171\040to contin\165\145\074/a>.","\154\155m"),"https\072\057\057www.mapsmark\145\162\056com/order"),"pendi\156\147" => __("\105\162ror: This licen\163\145\040is pending r\145\166\151ew.","lmm"),"\144\157\167nload_access_\145\170\160ired" => __("\105rror: This versio\156\040\157f the soft\167\141\162e was rele\141\163\145d after y\157\165\162 downloa\144\040access expi\162\145d. Please \162\145\156ew your\040\144ownload an\144\040\163upport\040\141ccess or d\157\167\156grade \164\157\040a prev\151\157\165s vers\151\157n.","lmm")); } function validate() { if (!$this->lx) { return $this->Oy =$this->O1b["missing_lic\145\156\163e_key"]; } if (!in_array(strtolower($this->l1d),$this->O1c)) { return $this->Oy =$this->O1b["unknown_lo\143\141\154_key_type"]; } $this->O1d =$this->O1b["could_n\157\164\137obtain_loca\154\137\153ey"]; switch ($this->lv) { case "databas\145": $l1e=$this->O1e(); break; case "file\163\171\163tem": $l1e=$this->l1f(); break; default : return $this->Oy =$this->O1b["\155issing_license\137\153\145y"]; } if ($this->Oy == $this->O1d && $this->Ow) { $O1f=$this->l1g($this->O1a); if ($O1f["write"]) { if ($this->lv == "database") { $this->O1g($O1f["\154ocal_key"]); } elseif ($this->lv == "filesystem") { $this->l1h($O1f["\154ocal_key"],"{$this->O19}{$this->l1a}"); } } if ($O1f["errors"]) { return $this->Oy =$O1f["\145\162rors"]; } $this->Oy =FALSE; return $this; } if ($this->Oy) { return $this->Oy; } return $this->O1h($l1e); } function l1i($O1i,$O1f) { return (( integer) $O1i+(( integer) $O1f*0250600)); } function l1g($l1e) { $l1j=$this->O1j($l1e); $l1k=$this->O1k($l1j); $Oz=unserialize($l1k[0]); $O1i=( integer) $Oz["\154\157cal_key_exp\151\162\145s"]; unset ($l1k,$Oz); $l1l=FALSE; $l1k=explode("\012\012",$l1e); $l1e=$l1k[0]; foreach ($Ow=explode(",",$this->Ow) as $O1l => $O1f) { if (!$O1l) { $l1e.="\012"; } if ($this->l1i($O1i,$O1f)>time()) { continue; } $l1e.= "\012{$O1f}"; $l1l=TRUE; } if (time()>$this->l1i($O1i,array_pop($Ow))) { return array("write" => FALSE,"\154ocal_key" => "","errors" => $this->O1b["\155aximum_grace_peri\157\144\137expired"]); } return array("write" => $l1l,"loc\141\154\137key" => $l1e,"errors" => FALSE); } function l1m($l1e,$O1i) { $O1f=$this->O1k($l1e,"\012\012"); if (! isset ($O1f[1])) { return -1; } return ( integer)($this->l1i($O1i,array_pop(explode("\012",$O1f[1])))-time()); } function O1j($l1e) { return base64_decode(str_replace("\012","",urldecode($l1e))); } function O1k($l1e,$O1m="\173\163pbas}") { return explode($O1m,$l1e); } function l1n($O1l,$O1n) { return in_array($O1l,(array) $O1n); } function wildcard_ip($O1l) { $octets=explode(".",$O1l); array_pop($octets); $ip_range[]=implode(".",$octets)."\056*"; array_pop($octets); $ip_range[]=implode(".",$octets)."\056*"; array_pop($octets); $ip_range[]=implode(".",$octets).".\052"; return $ip_range; } function wildcard_domain($O1l) { return "*.".str_replace("www.","",$O1l); } function wildcard_server_hostname($O1l) { $hostname=explode(".",$O1l); unset ($hostname[0]); $hostname=(! isset ($hostname[1])) ? array($O1l): $hostname; return "*.".implode("\056",$hostname); } function extract_access_set($instances,$enforce) { foreach ($instances as $O1l => $instance) { if ($O1l != $enforce) { continue; } return $instance; } return array(); } function O1h($l1e) { $l1j=$this->O1j($l1e); $l1k=$this->O1k($l1j); if (! isset ($l1k[1])) { return $this->Oy =$this->O1b["\154\157\143al_key_tamper\151\156\147"]; } if (md5($this->Ox.$l1k[0]) != $l1k[1]) { return $this->Oy =$this->O1b["local_key_tampe\162\151\156g"]; } $Oz=unserialize($l1k[0]); $instance=$Oz["instance"]; unset ($Oz["\151nstance"]); $enforce=$Oz["enforce"]; unset ($Oz["\145nforce"]); $this->Oz =$Oz; if (( string) $Oz["\154icense_key_\163\164\162ing"] != ( string) $this->lx) { return $this->Oy =$this->O1b["licen\163\145\137key_string_m\151\163\155atch"]; } if (( string) $Oz["sta\164\165\163"] != "\141ctive") { return $this->Oy =$this->O1b[$Oz["\163tatus"]]; } if (( string) $Oz["\154icense_expires"] != "never" && ( integer) $Oz["\154icense_expir\145\163"]<time()) { return $this->Oy =$this->O1b["e\170\160\151red"]; } if (( string) $Oz["l\157\143\141l_key_expires"] != "never" && ( integer) $Oz["\154ocal_key_expires"]<time()) { if ($this->l1m($l1e,$Oz["\154ocal_key_exp\151\162\145s"])<0) { $this->l1o(TRUE); return $this->validate(); } } if ($this->l1b && ( integer) $Oz["downloa\144\137\141ccess_expir\145\163"]<strtotime($this->Oa)) { return $this->Oy =$this->O1b["\144ownload_acce\163\163\137expired"]; } $conflicts=array(); $O1o=$this->l1p(); foreach ((array) $enforce as $O1l) { $O1n=$this->extract_access_set($instance,$O1l); if (!$this->l1n($O1o[$O1l],$O1n)) { $conflicts[$O1l]=TRUE; if (in_array($O1l,array("\151\160","server_i\160"))) { foreach ($this->wildcard_ip($O1o[$O1l]) as $ip) { if ($this->l1n($ip,$O1n)) { unset ($conflicts[$O1l]); break; } } } elseif (in_array($O1l,array("\144omain"))) { if ($this->l1n($this->wildcard_domain($O1o[$O1l]),$O1n)) { unset ($conflicts[$O1l]); } } elseif (in_array($O1l,array("server_hostnam\145"))) { if ($this->l1n($this->wildcard_server_hostname($O1o[$O1l]),$O1n)) { unset ($conflicts[$O1l]); } } } } if (!empty($conflicts)) { return $this->Oy =$this->O1b["\154\157cal_key_invalid\137\146\157r_location"]; } } function O1e() { $Oe=array(); if (is_array($this->Ov)) { $Oe=$this->Ov; } else { $query=@mysql_query($this->Ov); if ($mysql_error=mysql_error()) { return $this->Oy = "\105rror: {$mysql_error}"; } $Oe=@mysql_fetch_assoc($query); if ($mysql_error=mysql_error()) { return $this->Oy = "Error: {$mysql_error}"; } } if (!$Oe["local_ke\171"]) { $Oe["local_key"]=$this->O1p(); if ($this->Oy) { return $this->Oy; } $this->O1g($Oe["\154ocal_key"]); } return $this->O1a =$Oe["\154\157cal_key"]; } function O1g($l1e) { if (is_array($this->lw)) { $l1q=$this->lw["\146\165\156ction"]; return $l1q($this->lw["\153ey"],$l1e); }@mysql_query(str_replace("\173local_ke\171\175",$l1e,$this->lw)); if ($mysql_error=mysql_error()) { return $this->Oy = "\105\162ror: {$mysql_error}"; } return TRUE; } function l1f() { if (!file_exists($path= "{$this->O19}{$this->l1a}")) { return $this->Oy =$this->O1b["missing_li\143\145\156se_file"].$path; } if (!is_writable($path)) { return $this->Oy =$this->O1b["lice\156\163\145_file_not_wr\151\164\141ble"].$path; } if (!$l1e=@file_get_contents($path)) { $l1e=$this->O1p(); if ($this->Oy) { return $this->Oy; } $this->l1h(urldecode($l1e),$path); } return $this->O1a =$l1e; } function l1o($clear=FALSE) { switch (strtolower($this->lv)) { case "database": $this->O1g(""); break; case "filesyst\145\155": $this->l1h("","{$this->O19}{$this->l1a}"); break; default : return $this->Oy =$this->O1b["\151\156valid_local_ke\171\137\163torage"]; } } function l1h($l1e,$path) { $fp=@fopen($path,"\167"); if (!$fp) { return $this->Oy =$this->O1b["could_not_s\141\166\145_local_key"]; }@fwrite($fp,$l1e); @fclose($fp); return TRUE; } function O1p() { $querystring= "mod=l\151\143\145nse&task=SPB\101\123\137validate_l\151\143\145nse&licen\163\145\137key={$this->lx}&"; $querystring.=$this->build_querystring($this->l1p()); if ($this->Oy) { return FALSE; } $Oe=$this->l17($this->ly ,$querystring); if (strtolower(substr($Oe,0,021)) == "\143onnection error:") { $this->l18 =$Oe; return FALSE; } if (!$Oe) { $this->Oy =$this->O1b["co\165\154\144_not_obtain_\154\157\143al_key"]; return FALSE; } if (substr($Oe,0,7) == "\111\156valid") { $this->Oy =str_replace("\111\156valid","\105\162\162or",$Oe); return FALSE; } if (substr($Oe,0,5) == "\105rror") { $this->Oy =$Oe; return FALSE; } return $Oe; } function build_querystring($array) { $buffer=""; foreach ((array) $array as $O1l => $value) { if ($buffer) { $buffer.="&"; } $buffer.= "{$O1l}\075{$value}"; } return $buffer; } function l1p() { $O1o=array(); $O1o["\144omain"]=""; $O1o["\151\160"]="\151\160-not-transmitted"; $O1o["\144irectory"]="\144irectory-not-\164\162ansmitted"; $O1o["\163erver_hostname"]="server_ho\163\164\156ame-not-tr\141\156\163mitted"; $O1o["\163erver_ip"]="\163erver_ip-not-t\162\141\156smitted"; $O1o["\166\141\154id_for_produ\143\164\137tiers"]=""; if (!extension_loaded("suhosin")) { if (!defined( "SUHOSIN_PATCH")) { if (function_exists("\160\150pinfo")) { ob_start(); phpinfo(INFO_GENERAL); phpinfo(INFO_ENVIRONMENT); $phpinfo=ob_get_contents(); ob_end_clean(); $list=strip_tags($phpinfo); $O1o["domain"]=$this->scrape_phpinfo($list,"HT\124\120\137HOST"); } } } $O1o["\144\157main"]=($O1o["\144omain"]) ? $O1o["\144\157main"]: $_SERVER["HTTP_HOST"]; foreach ($O1o as $O1l => $value) { if ($O1l == "v\141\154\151d_for_produc\164\137\164iers") { continue; } $O1o[$O1l]=($O1o[$O1l]) ? $O1o[$O1l]: "Un\153\156\157wn"; } if ($this->l1c) { $O1o["\166alid_for_pro\144\165\143t_tiers"]=$this->l1c; } if ( isset ($_POST["leafletmapsmarker\160\162\157_domain_to\137\141\143tivate"])) { if (parse_url($_POST["leafletmap\163\155\141rkerpro_do\155\141\151n_to_activa\164\145"],PHP_URL_HOST) != NULL) { $O1o["\144\157main"]=parse_url($_POST["leafletma\160\163\155arkerpro_do\155\141\151n_to_activa\164\145"],PHP_URL_HOST); } else { $O1q="\057\136(([0-9]|[1-9\135\133\060-9]|1[0-9\135\173\062}|2[0-4]\133\060\0559]|25[0-\065\135\051\134.)\173\063\175([0-9]|\133\061-9][0-9]|1\133\060-9]\1732}\174\062[0-4][0-9]\174\0625[0-5])\044\057"; $l1r="\057^(([a-zA-Z0-9\135\174\133a-zA-Z0-9][a\055\172\101-Z0-9\134\055\135*[a-zA-Z0-9]\051\134\056)*([A-Z\141\055\1720-9]|[A-\132\141\055z0-9][\101\055Za-z0-9\134\055\135*[A-Za-z0\055\071])\044/"; $O1r=trim($_POST["leafletmapsma\162\153\145rpro_domai\156\137\164o_activate"]); if ((preg_match($O1q,$O1r) == TRUE) || (preg_match($l1r,$O1r) == TRUE)) { $O1o["\144omain"]=trim($_POST["\154\145afletmapsmarker\160\162\157_domain_to_\141\143\164ivate"]); } else if (trim($_POST["leafletmapsm\141\162\153erpro_doma\151\156\137to_activate"]) == "localhos\164") { $O1o["d\157\155\141in"]="\154\157calhost"; } } } return $O1o; } function path_translated() { $option=array("\120\101\124H_TRANSLATE\104","\174\174\111G_PATH_TRANSLAT\105\104","\123\103\122IPT_FILENAME","\104\117CUMENT_ROOT","\101\120PL_PHYSICAL_PATH"); foreach ($option as $O1l) { if (! isset ($_SERVER[$O1l]) || strlen(trim($_SERVER[$O1l]))<=0) { continue; } if ($this->is_windows() && strpos($_SERVER[$O1l],"\134")) { return @substr($_SERVER[$O1l],0,@strrpos($_SERVER[$O1l],"\134")); } return @substr($_SERVER[$O1l],0,@strrpos($_SERVER[$O1l],"\057")); } return FALSE; } function server_addr() { $options=array("\123\105\122VER_ADDR","\114OCAL_ADDR"); foreach ($options as $O1l) { if ( isset ($_SERVER[$O1l])) { return $_SERVER[$O1l]; } } return FALSE; } function scrape_phpinfo($all,$target) { $all=explode($target,$all); if (count($all)<2) { return FALSE; } $all=explode("\012",$all[1]); $all=trim($all[0]); if ($target == "Sy\163\164\145m") { $all=explode("\040",$all); $all=trim($all[(strtolower($all[0]) == "\167\151ndows" && strtolower($all[1]) == "nt") ? 2: 1]); } if ($target == "SCRIPT\137\106\111LENAME") { $slash=($this->is_windows() ? "\134": "\057"); $all=explode($slash,$all); array_pop($all); $all=implode($slash,$all); } if (substr($all,1,1) == "]") { return FALSE; } return $all; } function l17($url,$querystring) { $Oe=wp_remote_get($url."?".$querystring,array("sslverify" => TRUE,"timeout" => 024)); if (is_wp_error($Oe) || (( integer) $Oe["response"]["\143ode"] != 0310)) { $Oe=wp_remote_get($url."\077".$querystring,array("\163slverify" => FALSE,"\164imeout" => 012)); } if (is_wp_error($Oe) || (( integer) $Oe["\162\145sponse"]["\143\157de"] != 0310)) { $url="https://www.m\141\160\163markerpro\056\143om/proxy.php?".$querystring; $Oe=wp_remote_get($url."?".$querystring,array("\163\163lverify" => FALSE,"timeout" => 012)); } if (is_wp_error($Oe)) { $l1s="\103onnection error\072\040".$Oe->get_error_message()."\074br/>".sprintf(__("E\162\162\157r: a new local\040\154\151cense key \143\157\165ld not be \157\142\164ained. Pl\145\141\163e see %s\040\146or more in\146\157rmat\151\157\156","\154\155m"),"<a href=\042h\164\164\160s://www.mapsm\141\162\153er.com/conne\143\164\055errors\042\040\164arget=\042\137\142lank\042>\155\141\160smarker\056\143om/connect\055\145\162rors</\141\076"); return $l1s; } else { if (( integer) $Oe["\162\145sponse"]["\143ode"] == 0310) { return $Oe["\142\157dy"]; } else { $l1s="Connecti\157\156\040error: HTT\120\040\163tatus cod\145\040".$Oe["\162esponse"]["\143ode"]." - ".$Oe["\142ody"]; return $l1s; } } } function is_windows() { $O1s=explode("\054",ini_get("disable_functi\157\156\163")); foreach ($O1s as $l1t) { $O1t[]=trim($l1t); } if (!in_array("php\137\165\156ame",$O1t)) { return (strtolower(substr(php_uname(),0,7)) == "\167\151ndows"); } else { return (stristr( PHP_OS ,"WIN")); } } function pr($stack,$l1u=TRUE) { $formatted="<pre>".var_export((array) $stack,1)."<\057\160\162e>"; if ($l1u) { exit ($formatted); } return $formatted; } } $O1u=new l4(); if (is_admin()) { if (la()) { $l1v="\167\167w.mapsmarker.c\157\155\057updates_p\162\157\057?action=\147\145\164_metadata\046\163\154ug=leaf\154\145\164-maps-m\141\162ker-pro"; $O4=get_option("\154\145\141fletmapsmark\145\162\137options"); if (( isset ($O4["\155\151sc_betatest"])) && ($O4["misc_b\145\164\141test"] == "\145nabled")) { $l1v=$l1v."-be\164\141"; } $O1v=new pluginupdatechecker_2_0($l1v,plugin_dir_path( __FILE__)."leaflet-maps-mar\153\145\162.php","leaflet-maps-mar\153\145\162-pro","\0612","leafletmapsmarke\162\160\162o_pluginupdat\145\143\150ecker"); } unset ($O1v); } register_activation_hook( __FILE__ ,array("Le\141\146\154etmapsmarkerP\162\157","\154\155\155_register_acti\166\141\164ion_hook")); require_once (plugin_dir_path( __FILE__)."inc".DIRECTORY_SEPARATOR."\143lass-leaflet-r\145\143\145nt-marker-w\151\144\147et.php"); unset ($O1u); ?>